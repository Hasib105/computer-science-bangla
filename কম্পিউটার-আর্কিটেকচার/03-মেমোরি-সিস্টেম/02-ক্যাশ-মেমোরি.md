# ржХрзНржпрж╛рж╢ ржорзЗржорзЛрж░рж┐
## Chapter 08: Cache Memory

---

## ЁЯУМ ржХрзНржпрж╛рж╢ ржорзЗржорзЛрж░рж┐ ржХрзА?

ржХрзНржпрж╛рж╢ рж╣рж▓рзЛ CPU ржУ Main Memory ржПрж░ ржоржзрзНржпрзЗ ржЕржмрж╕рзНржерж┐ржд ржжрзНрж░рзБрждржЧрждрж┐рж░ ржХрзНрж╖рзБржжрзНрж░ ржорзЗржорзЛрж░рж┐ред

```
тФМтФАтФАтФАтФАтФАтФР     тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР     тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ CPU тФВтЧАтФАтФАтФАтЦ╢тФВ  Cache  тФВтЧАтФАтФАтФАтЦ╢тФВ   RAM    тФВ
тФФтФАтФАтФАтФАтФАтФШ     тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ     тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
  1 cycle    4-40 cycles    100+ cycles
```

---

## ЁЯУК ржХрзНржпрж╛рж╢ рж╕рзНрждрж░

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                   CPU                       тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР   тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР   тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФВ
тФВ  тФВ Core 0  тФВ   тФВ Core 1  тФВ   тФВ Core 2  тФВ  тФВ
тФВ  тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд  тФВ
тФВ  тФВL1 IтФВL1 DтФВ   тФВL1 IтФВL1 DтФВ   тФВL1 IтФВL1 DтФВ  тФВ
тФВ  тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд  тФВ
тФВ  тФВ   L2    тФВ   тФВ   L2    тФВ   тФВ   L2    тФВ  тФВ
тФВ  тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ   тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ   тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ  тФВ
тФВ       тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ       тФВ
тФВ              тФМтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФР              тФВ
тФВ              тФВ  L3 (Shared)тФВ              тФВ
тФВ              тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ              тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

| Level | Size | Latency | Shared |
|-------|------|---------|--------|
| L1 I-Cache | 32 KB | 4 cycles | No |
| L1 D-Cache | 32 KB | 4 cycles | No |
| L2 Cache | 256 KB-1 MB | 12 cycles | No |
| L3 Cache | 8-64 MB | 40 cycles | Yes |

---

## ЁЯОп Cache Hit ржУ Miss

### Cache Hit
- ржбрж╛ржЯрж╛ ржХрзНржпрж╛рж╢рзЗ ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗ
- ржжрзНрж░рзБржд ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕

### Cache Miss
- ржбрж╛ржЯрж╛ ржХрзНржпрж╛рж╢рзЗ ржирзЗржЗ
- Main memory ржерзЗржХрзЗ ржЖржирждрзЗ рж╣ржмрзЗ

### Miss ржПрж░ ржкрзНрж░ржХрж╛рж░
1. **Compulsory Miss**: ржкрзНрж░ржержоржмрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕
2. **Capacity Miss**: ржХрзНржпрж╛рж╢ ржкрзВрж░рзНржг
3. **Conflict Miss**: ржПржХржЗ рж▓рзЛржХрзЗрж╢ржирзЗ ржорзНржпрж╛ржкрж┐ржВ

### Hit Rate ржУ Miss Rate
```
Hit Rate = Cache Hits / Total Accesses
Miss Rate = 1 - Hit Rate

Average Access Time = Hit Time + (Miss Rate ├Ч Miss Penalty)
```

---

## ЁЯЧ║я╕П Cache Mapping

### рзз. Direct Mapped Cache
ржкрзНрж░рждрж┐ржЯрж┐ ржорзЗржорзЛрж░рж┐ ржмрзНрж▓ржХ рж╢рзБржзрзБ ржПржХржЯрж┐ ржХрзНржпрж╛рж╢ рж▓рж╛ржЗржирзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

```
Cache Line = (Memory Block) mod (Number of Cache Lines)

тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ            Memory Address                 тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ   Tag    тФВ   Index    тФВ  Block Offset   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

ржЙржжрж╛рж╣рж░ржг: 8 cache lines
Block 0  тЖТ Line 0
Block 1  тЖТ Line 1
...
Block 7  тЖТ Line 7
Block 8  тЖТ Line 0  (conflict!)
Block 9  тЖТ Line 1
```

**рж╕рзБржмрж┐ржзрж╛**: рж╕рж╣ржЬ, ржжрзНрж░рзБржд
**ржЕрж╕рзБржмрж┐ржзрж╛**: ржмрзЗрж╢рж┐ conflict miss

### рзи. Fully Associative Cache
ржпрзЗржХрзЛржирзЛ ржорзЗржорзЛрж░рж┐ ржмрзНрж▓ржХ ржпрзЗржХрзЛржирзЛ ржХрзНржпрж╛рж╢ рж▓рж╛ржЗржирзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ            Memory Address                 тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ          Tag           тФВ  Block Offset   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Block 0  тЖТ Any Line
Block 8  тЖТ Any Line
Block 16 тЖТ Any Line
```

**рж╕рзБржмрж┐ржзрж╛**: ржХржо conflict miss
**ржЕрж╕рзБржмрж┐ржзрж╛**: ржЬржЯрж┐рж▓, ржзрзАрж░ search

### рзй. Set Associative Cache
Direct ржУ Fully Associative ржПрж░ рж╕ржоржирзНржмржпрж╝ред

```
N-way Set Associative: ржкрзНрж░рждрж┐ рж╕рзЗржЯрзЗ N ржЯрж┐ рж▓рж╛ржЗржи

тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ            Memory Address                 тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ   Tag    тФВ Set Index  тФВ  Block Offset   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

2-way Set Associative (4 sets):
Block 0  тЖТ Set 0, Way 0 or 1
Block 4  тЖТ Set 0, Way 0 or 1  (same set)
```

---

## ЁЯФД Replacement Policy

### рзз. LRU (Least Recently Used)
рж╕ржмржЪрзЗржпрж╝рзЗ ржХржо ржмрзНржпржмрж╣рзГржд рж▓рж╛ржЗржи ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи

```
Access: A B C D A B E
LRU order: E replaces C (oldest unused)
```

### рзи. FIFO (First In First Out)
ржкрзНрж░ржержорзЗ ржЖрж╕рж╛ ржкрзНрж░ржержорзЗ ржпрж╛ржмрзЗ

### рзй. Random
ржПрж▓рзЛржорзЗрж▓рзЛржнрж╛ржмрзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи

### рзк. LFU (Least Frequently Used)
рж╕ржмржЪрзЗржпрж╝рзЗ ржХржо ржмрзНржпржмрж╣рзГржд

---

## тЬНя╕П Write Policy

### Write Hit

**Write Through**:
- ржХрзНржпрж╛рж╢ ржУ ржорзЗржорзЛрж░рж┐ ржжрзБржЯрзЛрждрзЗржЗ рж▓рзЗржЦрж╛
- рж╕рж╛ржоржЮрзНржЬрж╕рзНржпрждрж╛ ржмржЬрж╛ржпрж╝
- ржзрзАрж░

**Write Back**:
- рж╢рзБржзрзБ ржХрзНржпрж╛рж╢рзЗ рж▓рзЗржЦрж╛
- Dirty bit ржмрзНржпржмрж╣рж╛рж░
- ржорзЗржорзЛрж░рж┐рждрзЗ ржкрж░рзЗ рж▓рзЗржЦрж╛
- ржжрзНрж░рзБржд

### Write Miss

**Write Allocate**:
- ржмрзНрж▓ржХ ржХрзНржпрж╛рж╢рзЗ ржЖржирж╛
- рждрж╛рж░ржкрж░ рж▓рзЗржЦрж╛

**No Write Allocate**:
- рж╕рж░рж╛рж╕рж░рж┐ ржорзЗржорзЛрж░рж┐рждрзЗ рж▓рзЗржЦрж╛

---

## ЁЯУР Cache Size ржЧржгржирж╛

```
Cache Size = Number of Lines ├Ч Line Size (bytes)

Address Bits:
- Tag bits = Address bits - Index bits - Offset bits
- Index bits = logтВВ(Number of Sets)
- Offset bits = logтВВ(Block Size)

ржЙржжрж╛рж╣рж░ржг:
32-bit address, 64 KB cache, 64 byte blocks, 4-way

Block Size = 64 bytes тЖТ Offset = 6 bits
Sets = 64 KB / (64 ├Ч 4) = 256 тЖТ Index = 8 bits
Tag = 32 - 8 - 6 = 18 bits
```

---

## ЁЯТб Cache Optimization

### рзз. Larger Block Size
- Spatial locality exploitation
- ржХрж┐ржирзНрждрзБ miss penalty ржмрж╛ржбрж╝рзЗ

### рзи. Larger Cache
- Miss rate ржХржорзЗ
- ржХрж┐ржирзНрждрзБ access time ржмрж╛ржбрж╝рзЗ

### рзй. Higher Associativity
- Conflict miss ржХржорзЗ
- ржХрж┐ржирзНрждрзБ complexity ржмрж╛ржбрж╝рзЗ

### рзк. Multi-level Cache
- L1 ржжрзНрж░рзБржд, L2/L3 ржмржбрж╝

### рзл. Prefetching
- ржнржмрж┐рж╖рзНржпрждрзЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржбрж╛ржЯрж╛ ржЖржЧрзЗ ржЖржирж╛

---

## тЬПя╕П ржЕржирзБрж╢рзАрж▓ржирзА

1. Direct Mapped, Set Associative ржУ Fully Associative рждрзБрж▓ржирж╛ ржХрж░рзБржиред
2. 32 KB, 4-way, 32 byte block ржХрзНржпрж╛рж╢рзЗрж░ ржЬржирзНржп address breakdown ржХрж░рзБржиред
3. Write Through ржУ Write Back ржПрж░ ржкрж╛рж░рзНржержХрзНржп ржХрзА?

---

## ЁЯУЪ ржкрж░ржмрж░рзНрждрзА ржЕржзрзНржпрж╛ржпрж╝
[ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржорзЗржорзЛрж░рж┐](./03-ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓-ржорзЗржорзЛрж░рж┐.md)
