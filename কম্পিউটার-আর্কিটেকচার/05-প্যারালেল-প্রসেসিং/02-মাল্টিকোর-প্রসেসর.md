# à¦®à¦¾à¦²à§à¦Ÿà¦¿à¦•à§‹à¦° à¦ªà§à¦°à¦¸à§‡à¦¸à¦°
## Chapter 14: Multicore Processors

---

## ğŸ“Œ à¦®à¦¾à¦²à§à¦Ÿà¦¿à¦•à§‹à¦° à¦ªà§à¦°à¦¸à§‡à¦¸à¦° à¦•à§€?

à¦®à¦¾à¦²à§à¦Ÿà¦¿à¦•à§‹à¦° à¦ªà§à¦°à¦¸à§‡à¦¸à¦° à¦¹à¦²à§‹ à¦à¦•à¦Ÿà¦¿ à¦šà¦¿à¦ªà§‡ à¦à¦•à¦¾à¦§à¦¿à¦• à¦¸à§à¦¬à¦¾à¦§à§€à¦¨ CPU coreà¥¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Multicore Processor                       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Core 0    â”‚  â”‚   Core 1    â”‚  â”‚   Core 2    â”‚   ...   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚ â”‚L1 Iâ”‚L1 Dâ”‚ â”‚  â”‚ â”‚L1 Iâ”‚L1 Dâ”‚ â”‚  â”‚ â”‚L1 Iâ”‚L1 Dâ”‚ â”‚         â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚ â”‚   L2    â”‚ â”‚  â”‚ â”‚   L2    â”‚ â”‚  â”‚ â”‚   L2    â”‚ â”‚         â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                â”‚                â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â”‚                                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                   â”‚  L3 Cache   â”‚  (Shared)                 â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                          â”‚                                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                   â”‚ Memory Ctrl â”‚                           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ à¦•à§‡à¦¨ à¦®à¦¾à¦²à§à¦Ÿà¦¿à¦•à§‹à¦°?

### Power Wall
```
Power âˆ FrequencyÂ³

Clock speed à¦¬à¦¾à¦¡à¦¼à¦¾à¦²à§‡ power à¦“ heat à¦…à¦¨à§‡à¦• à¦¬à¦¾à¦¡à¦¼à§‡à¥¤
à¦¸à¦®à¦¾à¦§à¦¾à¦¨: à¦à¦•à¦¾à¦§à¦¿à¦• slower core
```

### ILP Wall
```
Single core à¦ ILP extraction à¦à¦° à¦¸à§€à¦®à¦¾à¥¤
Diminishing returns after certain pointà¥¤
```

### Memory Wall
```
CPU speed >> Memory speed
à¦†à¦°à¦“ core à¦¦à¦¿à¦²à§‡ parallelism à¦¬à¦¾à¦¡à¦¼à§‡à¥¤
```

---

## ğŸ—ï¸ Multicore Architecture Types

### Homogeneous (à¦¸à¦®à¦œà¦¾à¦¤à§€à¦¯à¦¼)
```
à¦¸à¦¬ core à¦à¦•à¦‡ à¦°à¦•à¦®à¥¤
Example: Intel Core i7, AMD Ryzen

â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚Core 0 â”‚ â”‚Core 1 â”‚ â”‚Core 2 â”‚ â”‚Core 3 â”‚
â”‚(Same) â”‚ â”‚(Same) â”‚ â”‚(Same) â”‚ â”‚(Same) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Heterogeneous (à¦¬à¦¿à¦·à¦®à¦œà¦¾à¦¤à§€à¦¯à¦¼)
```
à¦­à¦¿à¦¨à§à¦¨ à¦§à¦°à¦¨à§‡à¦° coreà¥¤
Example: ARM big.LITTLE, Apple M1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚P-Core 0 â”‚ â”‚P-Core 1 â”‚ â”‚E-Core0â”‚ â”‚E-Core1â”‚
â”‚(Big)    â”‚ â”‚(Big)    â”‚ â”‚(Littleâ”‚ â”‚(Littleâ”‚
â”‚High Perfâ”‚ â”‚High Perfâ”‚ â”‚Low Pwrâ”‚ â”‚Low Pwrâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

P-Core = Performance Core
E-Core = Efficiency Core
```

---

## ğŸ”— Cache Coherence

### à¦¸à¦®à¦¸à§à¦¯à¦¾
```
Core 0 Cache: x = 5
Core 1 Cache: x = 5

Core 0: x = 10 (update cache)

Core 0 Cache: x = 10
Core 1 Cache: x = 5  â† Stale data!
```

### MESI Protocol

| State | Modified | Exclusive | Shared | Invalid |
|-------|----------|-----------|--------|---------|
| Cache has | Yes | Yes | Yes | No |
| Memory valid | No | Yes | Yes | - |
| Other caches | No | No | Maybe | Maybe |

```
States:
M (Modified): Cache à¦ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤, memory à¦¤à§‡ à¦ªà§à¦°à¦¾à¦¤à¦¨
E (Exclusive): Cache à¦, memory à¦¤à§‡ à¦¸à¦®à¦¾à¦¨, à¦…à¦¨à§à¦¯ cache à¦ à¦¨à§‡à¦‡
S (Shared): Cache à¦, memory à¦¤à§‡ à¦¸à¦®à¦¾à¦¨, à¦…à¦¨à§à¦¯ cache à¦à¦“ à¦¥à¦¾à¦•à¦¤à§‡ à¦ªà¦¾à¦°à§‡
I (Invalid): à¦…à¦¬à§ˆà¦§

State Transitions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚         Read Miss        Write Hit                â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚      â”‚           â”‚    â”‚           â”‚              â”‚
â”‚      â–¼           â”‚    â–¼           â”‚              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  I  â”‚â”€â”€â”€â”€â–¶â”‚  S  â”‚â”€â”€â”€â”€â”€â–¶â”‚  M  â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜              â”‚
â”‚      â–²           â”‚           â”‚                   â”‚
â”‚      â”‚           â”‚           â”‚                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         Other Write (Snoop)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Snooping Protocol
```
Bus à¦ à¦¸à¦¬ transaction monitor à¦•à¦°à¦¾à¥¤

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Bus                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚Cacheâ”‚   â”‚Cacheâ”‚   â”‚Cacheâ”‚   â”‚Cacheâ”‚                 â”‚
â”‚  â”‚ 0   â”‚   â”‚ 1   â”‚   â”‚ 2   â”‚   â”‚ 3   â”‚                 â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜                 â”‚
â”‚     â”‚         â”‚         â”‚         â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    Snoop Bus                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Directory-Based Protocol
```
à¦¬à¦¡à¦¼ system à¦ à¦¬à§à¦¯à¦¬à¦¹à§ƒà¦¤à¥¤

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Directory                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Address â”‚ State â”‚ Sharers List                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 0x1000  â”‚   S   â”‚ Core 0, Core 2, Core 5        â”‚   â”‚
â”‚  â”‚ 0x2000  â”‚   M   â”‚ Core 3                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Memory Consistency

### Sequential Consistency
```
à¦¸à¦¬ core à¦à¦•à¦‡ order à¦¦à§‡à¦–à§‡à¥¤

Core 0: A = 1; B = 2;
Core 1: print(B); print(A);

Output possibilities:
(0,0), (0,1), (2,0)? No!, (2,1)
```

### Relaxed Consistency
```
Performance à¦à¦° à¦œà¦¨à§à¦¯ à¦•à¦¿à¦›à§ reordering allowà¥¤
- Total Store Order (TSO)
- Release Consistency
```

---

## âš¡ SMT (Simultaneous Multithreading)

### Hyper-Threading
```
à¦à¦•à¦Ÿà¦¿ core à¦ à¦à¦•à¦¾à¦§à¦¿à¦• threadà¥¤

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Single Core with SMT            â”‚
â”‚                                              â”‚
â”‚  Thread 0 State    Thread 1 State           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Registers   â”‚  â”‚ Registers   â”‚           â”‚
â”‚  â”‚ PC          â”‚  â”‚ PC          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                  â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Shared Execution Units          â”‚  â”‚
â”‚  â”‚  ALU â”‚ FPU â”‚ Load/Store â”‚ Branch      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¦¸à§à¦¬à¦¿à¦§à¦¾
- Better resource utilization
- Hide memory latency

### à¦…à¦¸à§à¦¬à¦¿à¦§à¦¾
- Cache contention
- Security issues

---

## ğŸ“Š Modern Multicore Examples

### Intel Core i9 (Desktop)
```
- 8 P-cores + 16 E-cores
- P-core: Hyper-threaded
- 24 cores, 32 threads
- L3: 36 MB shared
```

### Apple M2 Pro
```
- 8 P-cores + 4 E-cores
- Unified memory
- 19-core GPU
- Neural Engine
```

### AMD EPYC (Server)
```
- Up to 96 cores
- 8 memory channels
- PCIe 5.0
```

---

## âœï¸ à¦…à¦¨à§à¦¶à§€à¦²à¦¨à§€

1. Cache Coherence à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¬à§à¦¯à¦¾à¦–à§à¦¯à¦¾ à¦•à¦°à§à¦¨à¥¤
2. MESI protocol à¦à¦° state transition diagram à¦†à¦à¦•à§à¦¨à¥¤
3. Homogeneous à¦“ Heterogeneous multicore à¦à¦° à¦¤à§à¦²à¦¨à¦¾ à¦•à¦°à§à¦¨à¥¤

---

## ğŸ“š à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦…à¦§à§à¦¯à¦¾à¦¯à¦¼
[SIMD à¦“ MIMD](./03-SIMD-à¦“-MIMD.md)
