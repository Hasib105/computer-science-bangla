# Synchronization in Distributed Systems

## ğŸ“Œ Clock Synchronization à¦•à§‡à¦¨ à¦¦à¦°à¦•à¦¾à¦°?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ machine à¦à¦° à¦¨à¦¿à¦œà¦¸à§à¦¬ clock à¦†à¦›à§‡                      â”‚
â”‚   Clocks drift apart over time                              â”‚
â”‚                                                             â”‚
â”‚   Node A                    Node B                          â”‚
â”‚   Clock: 10:00:00          Clock: 10:00:05                  â”‚
â”‚                                                             â”‚
â”‚   Problem: Event ordering                                   â”‚
â”‚   â€¢ A sends message at 10:00:00                            â”‚
â”‚   â€¢ B receives at 10:00:03 (B's clock)                     â”‚
â”‚   â€¢ Which happened first?                                   â”‚
â”‚                                                             â”‚
â”‚   Important for:                                            â”‚
â”‚   â€¢ Make (compile only changed files)                       â”‚
â”‚   â€¢ Distributed databases                                   â”‚
â”‚   â€¢ Security (certificate expiry)                           â”‚
â”‚   â€¢ Logging and debugging                                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â° Physical Clock Synchronization

### Cristian's Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cristian's Algorithm                       â”‚
â”‚                                                             â”‚
â”‚   Client                           Time Server              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚        â”‚                       â”‚        â”‚              â”‚
â”‚   â”‚  T1    â”‚ â”€â”€â”€â”€â”€â”€ Request â”€â”€â”€â”€â”€â–º â”‚        â”‚              â”‚
â”‚   â”‚        â”‚                       â”‚   T    â”‚              â”‚
â”‚   â”‚  T2    â”‚ â—„â”€â”€â”€â”€â”€ T (time) â”€â”€â”€â”€â”€ â”‚        â”‚              â”‚
â”‚   â”‚        â”‚                       â”‚        â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚   Round trip time = T2 - T1                                â”‚
â”‚   Estimated server time = T + (T2 - T1)/2                  â”‚
â”‚                                                             â”‚
â”‚   Example:                                                  â”‚
â”‚   T1 = 10:00:00.000                                        â”‚
â”‚   T2 = 10:00:00.100 (100ms later)                          â”‚
â”‚   Server sent T = 10:00:05.000                             â”‚
â”‚   Set clock to: 10:00:05.000 + 0.050 = 10:00:05.050        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NTP (Network Time Protocol)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NTP                                 â”‚
â”‚                                                             â”‚
â”‚   Hierarchical structure (Strata):                          â”‚
â”‚                                                             â”‚
â”‚        Stratum 0:  Atomic clocks, GPS                      â”‚
â”‚             â”‚                                               â”‚
â”‚             â–¼                                               â”‚
â”‚        Stratum 1:  Primary time servers                    â”‚
â”‚           / â”‚ \                                            â”‚
â”‚          â–¼  â–¼  â–¼                                           â”‚
â”‚        Stratum 2:  Secondary servers                       â”‚
â”‚         /  â”‚  \                                            â”‚
â”‚        â–¼   â–¼   â–¼                                           â”‚
â”‚        Stratum 3:  Corporate servers                       â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”‚        Stratum 4+: End clients                             â”‚
â”‚                                                             â”‚
â”‚   Each stratum adds delay, lower accuracy                   â”‚
â”‚   Stratum 16 = unsynchronized                               â”‚
â”‚                                                             â”‚
â”‚   Accuracy: ~1ms on LAN, ~10ms on Internet                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¢ Logical Clocks

### Lamport Clock

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lamport Clock                            â”‚
â”‚                                                             â”‚
â”‚   "Happened-before" relationship: a â†’ b                    â”‚
â”‚                                                             â”‚
â”‚   Rules:                                                    â”‚
â”‚   1. Before each event: increment counter                   â”‚
â”‚   2. On send: include counter in message                    â”‚
â”‚   3. On receive: counter = max(local, received) + 1         â”‚
â”‚                                                             â”‚
â”‚   Process A    Process B    Process C                       â”‚
â”‚      â”‚            â”‚            â”‚                            â”‚
â”‚     (1)           â”‚            â”‚       â† A does event      â”‚
â”‚      â”‚           (1)           â”‚       â† B does event      â”‚
â”‚     (2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º(3)      â† A sends to C      â”‚
â”‚      â”‚           (2) â”€â”€â”€â”€â”€â”€â”€â”€â–º(4)      â† B sends to C      â”‚
â”‚     (3)           â”‚            â”‚                            â”‚
â”‚      â”‚           (3)           â”‚                            â”‚
â”‚      â”‚            â”‚           (5)                           â”‚
â”‚                                                             â”‚
â”‚   If a â†’ b, then L(a) < L(b)                               â”‚
â”‚   But L(a) < L(b) doesn't mean a â†’ b                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vector Clock

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vector Clock                             â”‚
â”‚                                                             â”‚
â”‚   Each process maintains vector of all processes            â”‚
â”‚                                                             â”‚
â”‚   3 processes: Vector = [A, B, C]                          â”‚
â”‚                                                             â”‚
â”‚   Process A      Process B      Process C                   â”‚
â”‚   [1,0,0]          â”‚              â”‚        â† A event       â”‚
â”‚      â”‚          [0,1,0]           â”‚        â† B event       â”‚
â”‚   [2,0,0]          â”‚              â”‚        â† A event       â”‚
â”‚      â”‚             â”‚                                        â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[2,0,1]  â† Aâ†’C message  â”‚
â”‚                 â”‚                    â”‚                      â”‚
â”‚              [0,2,0]                 â”‚      â† B event      â”‚
â”‚                 â”‚                    â”‚                      â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[2,2,2]  â† Bâ†’C message  â”‚
â”‚                                                             â”‚
â”‚   Vector comparison:                                        â”‚
â”‚   V1 â‰¤ V2 if V1[i] â‰¤ V2[i] for all i                      â”‚
â”‚   V1 < V2 if V1 â‰¤ V2 and V1 â‰  V2                          â”‚
â”‚                                                             â”‚
â”‚   Can detect causality:                                     â”‚
â”‚   V1 < V2 means event1 â†’ event2 (causal)                  â”‚
â”‚   Neither < means concurrent!                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Distributed Mutual Exclusion

### Centralized Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Centralized                               â”‚
â”‚                                                             â”‚
â”‚          Coordinator                                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚          â”‚ Token  â”‚                                        â”‚
â”‚          â”‚ Server â”‚                                        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           /  â”‚  \                                          â”‚
â”‚          â–¼   â–¼   â–¼                                         â”‚
â”‚   Request  Grant  Release                                   â”‚
â”‚          â–¼   â–¼   â–¼                                         â”‚
â”‚       â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                                   â”‚
â”‚       â”‚ A â”‚ â”‚ B â”‚ â”‚ C â”‚                                   â”‚
â”‚       â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                                   â”‚
â”‚                                                             â”‚
â”‚   1. Process requests access from coordinator               â”‚
â”‚   2. Coordinator grants if resource free                    â”‚
â”‚   3. Process releases when done                             â”‚
â”‚                                                             â”‚
â”‚   âœ“ Simple, fair                                           â”‚
â”‚   âœ— Single point of failure                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token Ring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Token Ring                              â”‚
â”‚                                                             â”‚
â”‚           â”Œâ”€â”€â”€â”                                            â”‚
â”‚           â”‚ A â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚           â””â”€â”€â”€â”˜                     â”‚                      â”‚
â”‚             â”‚                       â”‚                      â”‚
â”‚             â–¼ token                 â”‚                      â”‚
â”‚           â”Œâ”€â”€â”€â”                   â”Œâ”€â”€â”€â”                   â”‚
â”‚           â”‚ B â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ D â”‚                   â”‚
â”‚           â””â”€â”€â”€â”˜                   â””â”€â”€â”€â”˜                   â”‚
â”‚             â”‚                       â–²                      â”‚
â”‚             â–¼                       â”‚                      â”‚
â”‚           â”Œâ”€â”€â”€â”                     â”‚                      â”‚
â”‚           â”‚ C â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚           â””â”€â”€â”€â”˜                                            â”‚
â”‚                                                             â”‚
â”‚   Token circulates around ring                              â”‚
â”‚   Only token holder can enter CS                            â”‚
â”‚                                                             â”‚
â”‚   âœ“ Fair, no starvation                                    â”‚
â”‚   âœ— Token loss problem                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—³ï¸ Election Algorithms

### Bully Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Bully Algorithm                           â”‚
â”‚                                                             â”‚
â”‚   Highest ID process becomes coordinator                    â”‚
â”‚                                                             â”‚
â”‚   Processes: P1, P2, P3, P4 (P4 is coordinator, fails)     â”‚
â”‚                                                             â”‚
â”‚   1. P1 detects failure, sends ELECTION to higher IDs      â”‚
â”‚      P1 â”€â”€ELECTIONâ”€â”€â–º P2, P3                               â”‚
â”‚                                                             â”‚
â”‚   2. Higher IDs respond OK (I'll take over)                â”‚
â”‚      P2 â”€â”€OKâ”€â”€â–º P1                                         â”‚
â”‚      P3 â”€â”€OKâ”€â”€â–º P1                                         â”‚
â”‚                                                             â”‚
â”‚   3. P1 stops (someone higher responded)                   â”‚
â”‚                                                             â”‚
â”‚   4. P3 (highest alive) sends COORDINATOR                  â”‚
â”‚      P3 â”€â”€COORDINATORâ”€â”€â–º P1, P2                            â”‚
â”‚                                                             â”‚
â”‚   P3 is new coordinator!                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â“ à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ à¦ªà§à¦°à¦¶à§à¦¨

**à¦ªà§à¦°à¦¶à§à¦¨ à§§:** Lamport vs Vector clock?

| Lamport | Vector |
|---------|--------|
| Single counter | Vector of counters |
| Partial ordering | Full causal ordering |
| Less space | More space O(n) |
| Can't detect concurrency | Can detect concurrency |

**à¦ªà§à¦°à¦¶à§à¦¨ à§¨:** Physical vs Logical clocks?

| Physical | Logical |
|----------|---------|
| Real time | Event ordering |
| Sync with UTC | No real time |
| NTP, Cristian's | Lamport, Vector |
| Hardware dependent | Software only |

**à¦ªà§à¦°à¦¶à§à¦¨ à§©:** Token ring à¦ token à¦¹à¦¾à¦°à¦¾à¦²à§‡ à¦•à¦¿ à¦•à¦°à¦¬à§‡à¦¨?
**à¦‰à¦¤à§à¦¤à¦°:** 
- Timeout based detection
- Election to regenerate token
- Only one token must exist

---
**à¦ªà§‚à¦°à§à¦¬à¦¬à¦°à§à¦¤à§€:** [Communication](02-communication.md)  
**à¦ªà¦°à¦¬à¦°à§à¦¤à§€:** [Distributed File Systems](04-distributed-file-systems.md)
