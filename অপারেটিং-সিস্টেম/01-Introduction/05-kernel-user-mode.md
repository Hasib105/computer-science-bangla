# ржХрж╛рж░рзНржирзЗрж▓ ржорзЛржб vs ржЗржЙржЬрж╛рж░ ржорзЛржб (Kernel Mode vs User Mode)

## ЁЯУМ ржжрзБржЗ ржорзЛржбрзЗрж░ ржзрж╛рж░ржгрж╛

CPU ржжрзБржЯрж┐ ржорзЛржбрзЗ ржХрж╛ржЬ ржХрж░рзЗ - ржПржЯрж┐ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗред

### ржбрж╛ржпрж╝рж╛ржЧрзНрж░рж╛ржо
```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              USER MODE                       тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ  тФВ   Applications (Browser, Games, etc.)  тФВ тФВ
тФВ  тФВ   тАв рж╕рзАржорж┐ржд ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕                     тФВ тФВ
тФВ  тФВ   тАв рж╕рж░рж╛рж╕рж░рж┐ рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ  тФВ тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ           тЖХ System Call Interface тЖХ         тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ              KERNEL MODE                     тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ  тФВ   Kernel (Process, Memory, File Mgmt)  тФВ тФВ
тФВ  тФВ   тАв рж╕ржорзНржкрзВрж░рзНржг ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕                 тФВ тФВ
тФВ  тФВ   тАв рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржХржирзНржЯрзНрж░рзЛрж▓              тФВ тФВ
тФВ  тФВ   тАв Privileged Instructions            тФВ тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯФ╖ ржЗржЙржЬрж╛рж░ ржорзЛржб (User Mode)

### ржмрзИрж╢рж┐рж╖рзНржЯрзНржп
- рж╕рж╛ржзрж╛рж░ржг ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржПржЦрж╛ржирзЗ ржЪрж▓рзЗ
- рж╕рзАржорж┐ржд ржорзЗржорж░рж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕
- Privileged instructions ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЗ ржирж╛
- ржХрзНрж░рзНржпрж╛рж╢ ржХрж░рж▓рзЗ рж╢рзБржзрзБ рж╕рзЗржЗ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмржирзНржз рж╣ржпрж╝

### ржЙржжрж╛рж╣рж░ржг ржкрзНрж░рзЛржЧрзНрж░рж╛ржо
- ржУржпрж╝рзЗржм ржмрзНрж░рж╛ржЙржЬрж╛рж░
- ржЧрзЗржорж╕
- ржЯрзЗржХрзНрж╕ржЯ ржПржбрж┐ржЯрж░
- ржорж┐ржбрж┐ржпрж╝рж╛ ржкрзНрж▓рзЗржпрж╝рж╛рж░

### рж╕рзАржорж╛ржмржжрзНржзрждрж╛
```
тЭМ рж╕рж░рж╛рж╕рж░рж┐ I/O ржЕржкрж╛рж░рзЗрж╢ржи ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛
тЭМ ржорзЗржорж░рж┐ ржорзНржпрж╛ржкрж┐ржВ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛
тЭМ ржЗржирзНржЯрж╛рж░рж╛ржкрзНржЯ ржирж┐рж╖рзНржХрзНрж░рж┐ржпрж╝ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛
тЭМ CPU ржорзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛
```

---

## ЁЯФ╢ ржХрж╛рж░рзНржирзЗрж▓ ржорзЛржб (Kernel Mode / Supervisor Mode)

### ржмрзИрж╢рж┐рж╖рзНржЯрзНржп
- OS ржХрж╛рж░рзНржирзЗрж▓ ржПржЦрж╛ржирзЗ ржЪрж▓рзЗ
- рж╕ржорзНржкрзВрж░рзНржг рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕
- рж╕ржм ржорзЗржорж░рж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп
- рж╕ржм CPU instruction ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЗ

### ржХрж╛рж░рзНржирзЗрж▓ ржорзЛржбрзЗ ржХрж┐ ржЪрж▓рзЗ?
- Device Drivers
- Process Scheduler
- Memory Manager
- File System

### Privileged Instructions
```
тЬЕ I/O operations
тЬЕ Memory management
тЬЕ Interrupt handling
тЬЕ Timer management
тЬЕ Context switching
```

---

## ЁЯФД ржорзЛржб рж╕рзБржЗржЪрж┐ржВ (Mode Switching)

### ржХржЦржи ржЗржЙржЬрж╛рж░ тЖТ ржХрж╛рж░рзНржирзЗрж▓?
1. **System Call:** ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржХрж╛рж░рзНржирзЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛ржЗрж▓рзЗ
2. **Interrupt:** рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржЗржирзНржЯрж╛рж░рж╛ржкрзНржЯ рж╣рж▓рзЗ
3. **Exception:** ржПрж░рж░ рж╣рж▓рзЗ (divide by zero)

### ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛
```
User Mode                         Kernel Mode
    тФВ                                  тФВ
    тФВ 1. System Call (open file)       тФВ
    тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЖТтФВ
    тФВ                                  тФВ
    тФВ 2. Save User State               тФВ
    тФВ    (registers, PC)               тФВ
    тФВ                                  тФВ
    тФВ 3. Execute Kernel Code           тФВ
    тФВ                                  тФВ
    тФВ 4. Restore User State            тФВ
    тФВ                                  тФВ
    тФВ 5. Return to User Mode           тФВ
    тФВтЖРтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
```

### Mode Bit
```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  CPU Status Register        тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФРтФВ
тФВ  тФВ ... тФВ Mode Bit тФВ ...    тФВтФВ
тФВ  тФВ     тФВ    тЖУ     тФВ        тФВтФВ
тФВ  тФВ     тФВ  0=KernelтФВ        тФВтФВ
тФВ  тФВ     тФВ  1=User  тФВ        тФВтФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШтФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯУК рждрзБрж▓ржирж╛ржорзВрж▓ржХ рж╕рж╛рж░ржгрзА

| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп | User Mode | Kernel Mode |
|----------|-----------|-------------|
| ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ | рж╕рзАржорж┐ржд | рж╕ржорзНржкрзВрж░рзНржг |
| ржорзЗржорж░рж┐ | ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржПрж▓рж╛ржХрж╛ | рж╕ржм ржорзЗржорж░рж┐ |
| I/O | рж╕рж░рж╛рж╕рж░рж┐ ржиржпрж╝ | рж╕рж░рж╛рж╕рж░рж┐ |
| ржХрзНрж░рзНржпрж╛рж╢ ржкрзНрж░ржнрж╛ржм | рж╢рзБржзрзБ рж╕рзЗржЗ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо | ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо |
| Mode Bit | 1 | 0 |
| ржкрзНрж░рзЛржЧрзНрж░рж╛ржо | Apps | OS Kernel |

---

## ЁЯЫбя╕П ржХрзЗржи ржжрзБржЗ ржорзЛржб ржкрзНрж░ржпрж╝рзЛржЬржи?

### рзз. ржирж┐рж░рж╛ржкрждрзНрждрж╛ (Security)
```
ржЗржЙржЬрж╛рж░ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо тЖТ Malicious Code
                     тЖУ
              рж╕рж░рж╛рж╕рж░рж┐ рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕
                     тЖУ
                 рж╕рж┐рж╕рзНржЯрзЗржо ржХрзНрж░рзНржпрж╛рж╢/рж╣рзНржпрж╛ржХ
                 
ржжрзБржЗ ржорзЛржбрзЗ: Malicious Code тЖТ User Mode ржП ржЖржЯржХрзЗ ржпрж╛ржпрж╝
```

### рзи. рж╕рзНржерж┐рждрж┐рж╢рзАрж▓рждрж╛ (Stability)
```
ржмрж╛ржЧрж┐ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржХрзНрж░рзНржпрж╛рж╢ ржХрж░рж▓рзЗ:
User Mode: рж╢рзБржзрзБ рж╕рзЗржЗ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмржирзНржз
Kernel Mode: ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо ржХрзНрж░рзНржпрж╛рж╢ (Blue Screen)
```

### рзй. ржЖржЗрж╕рзЛрж▓рзЗрж╢ржи (Isolation)
```
ржкрзНрж░рждрж┐ржЯрж┐ ржкрзНрж░рзЛржЧрзНрж░рж╛ржорзЗрж░ ржирж┐ржЬрж╕рзНржм ржорзЗржорж░рж┐ рж╕рзНржкрзЗрж╕
ржПржХржЯрж┐ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржЕржирзНржпржЯрж┐рж░ ржбрзЗржЯрж╛ ржжрзЗржЦрждрзЗ ржкрж╛ржпрж╝ ржирж╛
```

---

## ЁЯФз Interrupt ржПржмржВ Trap

### Interrupt (ржмрж╛рж╣рзНржпрж┐ржХ)
```
Hardware Device тЖТ Signal тЖТ CPU тЖТ Kernel Mode
ржЙржжрж╛рж╣рж░ржг:
- ржХрзАржмрзЛрж░рзНржб ржкрзНрж░рзЗрж╕
- ржорж╛ржЙрж╕ ржХрзНрж▓рж┐ржХ
- ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржкрзНржпрж╛ржХрзЗржЯ ржЖрж╕рж╛
- ржЯрж╛ржЗржорж╛рж░
```

### Trap (ржЕржнрзНржпржирзНрждрж░рзАржг)
```
ржкрзНрж░рзЛржЧрзНрж░рж╛ржо Execution тЖТ Error/System Call тЖТ Kernel Mode
ржЙржжрж╛рж╣рж░ржг:
- Division by zero
- Invalid memory access
- System call
```

### Interrupt Handling Process
```
1. Save current state
2. Identify interrupt type
3. Jump to interrupt handler
4. Execute handler code
5. Restore state
6. Return to interrupted program
```

---

## ЁЯТ╗ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

### ржлрж╛ржЗрж▓ ржкржбрж╝рж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ
```python
# User Mode: ржкрзНрж░рзЛржЧрзНрж░рж╛ржо
file = open("data.txt")  # тЖР System Call
                          # тЖР Mode Switch to Kernel
# Kernel Mode:
# - Permission check
# - Find file on disk
# - Read data
# - Copy to user buffer
                          # тЖР Mode Switch to User
# User Mode: ржкрзНрж░рзЛржЧрзНрж░рж╛ржо
data = file.read()        # тЖР ржЖрж░рзЗржХржЯрж┐ System Call
```

---

## тЭУ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржкрзНрж░рж╢рзНржи

**ржкрзНрж░рж╢рзНржи рзз:** User Mode ржерзЗржХрзЗ Kernel Mode ржП ржХрж┐ржнрж╛ржмрзЗ ржпрж╛ржпрж╝?
**ржЙрждрзНрждрж░:** System Call, Hardware Interrupt, ржЕржержмрж╛ Exception ржПрж░ ржорж╛ржзрзНржпржорзЗред

**ржкрзНрж░рж╢рзНржи рзи:** ржХрзЗржи рж╕рж╛ржзрж╛рж░ржг ржкрзНрж░рзЛржЧрзНрж░рж╛ржо рж╕рж░рж╛рж╕рж░рж┐ I/O ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛?
**ржЙрждрзНрждрж░:** ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЬржирзНржпред ржХрзЛржирзЛ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржнрзБрж▓рзЗ ржмрж╛ ржЗржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ рж╣рж╛рж░рзНржбржУржпрж╝рзНржпрж╛рж░ ржХрзНрж╖рждрж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

**ржкрзНрж░рж╢рзНржи рзй:** Mode Bit ржХрж┐?
**ржЙрждрзНрждрж░:** CPU ржПрж░ ржПржХржЯрж┐ ржмрж┐ржЯ ржпрж╛ ржмрж░рзНрждржорж╛ржи ржорзЛржб ржирж┐рж░рзНржжрзЗрж╢ ржХрж░рзЗред 0 = Kernel, 1 = Userред

---
**ржкрзВрж░рзНржмржмрж░рзНрждрзА:** [OS ржПрж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░](04-os-structure.md)  
**ржкрж░ржмрж░рзНрждрзА:** [ржкрзНрж░рж╕рзЗрж╕ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ](../02-Process-Management/README.md)
