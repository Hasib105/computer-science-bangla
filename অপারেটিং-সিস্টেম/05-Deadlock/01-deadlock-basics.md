# Deadlock Basics (ржбрзЗржбрж▓ржХ ржорзМрж▓рж┐ржХ ржзрж╛рж░ржгрж╛)

## ЁЯУМ Deadlock ржХрж┐?

**Deadlock** рж╣рж▓рзЛ ржПржоржи ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржпрзЗржЦрж╛ржирзЗ ржПржХржжрж▓ ржкрзНрж░рж╕рзЗрж╕ ржПржоржиржнрж╛ржмрзЗ blocked рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ ржпрзЗ ржкрзНрж░рждрзНржпрзЗржХрзЗ ржЕржирзНржп ржкрзНрж░рж╕рзЗрж╕рзЗрж░ ржХрж╛ржЫрзЗ ржерж╛ржХрж╛ resource ржПрж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзЗред

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                       DEADLOCK                              тФВ
тФВ                                                             тФВ
тФВ        Process A                    Process B               тФВ
тФВ           тФВ                            тФВ                    тФВ
тФВ           тФВ  holds R1                  тФВ  holds R2          тФВ
тФВ           тФВ  wants R2                  тФВ  wants R1          тФВ
тФВ           тФВ                            тФВ                    тФВ
тФВ           тЦ╝                            тЦ╝                    тФВ
тФВ       тФМтФАтФАтФАтФАтФАтФАтФР                    тФМтФАтФАтФАтФАтФАтФАтФР                 тФВ
тФВ       тФВ  R1  тФВ                    тФВ  R2  тФВ                 тФВ
тФВ       тФФтФАтФАтФАтФАтФАтФАтФШ                    тФФтФАтФАтФАтФАтФАтФАтФШ                 тФВ
тФВ           тЦ▓                            тЦ▓                    тФВ
тФВ           тФВ                            тФВ                    тФВ
тФВ           тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ                    тФВ
тФВ                 Circular Wait!                              тФВ
тФВ                                                             тФВ
тФВ   A waits for R2 (held by B)                               тФВ
тФВ   B waits for R1 (held by A)                               тФВ
тФВ   Neither can proceed тЖТ DEADLOCK!                           тФВ
тФВ                                                             тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯФ┤ Deadlock ржПрж░ ржЪрж╛рж░ржЯрж┐ рж╢рж░рзНржд (Necessary Conditions)

```
ржЪрж╛рж░ржЯрж┐ рж╢рж░рзНржд ржПржХрж╕рж╛ржерзЗ ржкрзВрж░ржг рж╣рж▓рзЗржЗ Deadlock рж╣рждрзЗ ржкрж╛рж░рзЗ:

тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  1. Mutual Exclusion (ржкрж╛рж░рж╕рзНржкрж░рж┐ржХ ржмрж░рзНржЬржи)                     тФВ
тФВ     тАв Resource рж╢рзБржзрзБ ржПржХржЯрж┐ process ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗ         тФВ
тФВ     тАв Example: Printer, Tape drive                          тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  2. Hold and Wait (ржзрж░рзЗ рж░рж╛ржЦрж╛ ржУ ржЕржкрзЗржХрзНрж╖рж╛)                      тФВ
тФВ     тАв ржПржХржЯрж┐ resource ржзрж░рзЗ рж░рзЗржЦрзЗ ржЕржирзНржпржЯрж┐рж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛      тФВ
тФВ     тАв Example: Lock A ржзрж░рзЗ Lock B ржЪрж╛ржУржпрж╝рж╛                    тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  3. No Preemption (ржЕ-ржкрзНрж░рж┐ржорж╢ржи)                              тФВ
тФВ     тАв ржЬрзЛрж░ ржХрж░рзЗ resource ржХрзЗржбрж╝рзЗ ржирзЗржУржпрж╝рж╛ ржпрж╛ржпрж╝ ржирж╛                 тФВ
тФВ     тАв Process ржирж┐ржЬрзЗ ржЫрзЗржбрж╝рзЗ ржжрж┐рждрзЗ рж╣ржпрж╝                          тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  4. Circular Wait (ржЪржХрзНрж░рж╛ржХрж╛рж░ ржЕржкрзЗржХрзНрж╖рж╛)                        тФВ
тФВ     тАв P1тЖТP2тЖТP3тЖТ...тЖТPnтЖТP1 ржПржнрж╛ржмрзЗ ржЕржкрзЗржХрзНрж╖рж╛рж░ ржЪржХрзНрж░              тФВ
тФВ     тАв ржкрзНрж░рждрзНржпрзЗржХрзЗ ржкрж░рзЗрж░ржЬржирзЗрж░ resource ржЪрж╛ржпрж╝                     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯТб ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

### Traffic Deadlock

```
                    тХС
               тХРтХРтХРтХРтХРтХмтХРтХРтХРтХРтХР
                    тХС Car 2
            тФАтФАтФАтФАтФАтФАтФАтФАтХмтФАтФАтФАтФАтФАтФАтФАтФА
              Car 3 тХС Car 1
               тХРтХРтХРтХРтХРтХмтХРтХРтХРтХРтХР
                    тХС Car 4
                    
    ржЪрж╛рж░ржЯрж┐ ржЧрж╛ржбрж╝рж┐ intersection ржП
    ржкрзНрж░рждрзНржпрзЗржХрзЗ ржбрж╛ржиржжрж┐ржХрзЗрж░ ржЧрж╛ржбрж╝рж┐рж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржЫрзЗ
    ржХрзЗржЙржЗ ржПржЧрзЛрждрзЗ ржкрж╛рж░ржЫрзЗ ржирж╛!
```

### Code Example

```c
// Thread 1                    // Thread 2
pthread_mutex_lock(&A);        pthread_mutex_lock(&B);
pthread_mutex_lock(&B);        pthread_mutex_lock(&A);
// Critical Section            // Critical Section
pthread_mutex_unlock(&B);      pthread_mutex_unlock(&A);
pthread_mutex_unlock(&A);      pthread_mutex_unlock(&B);

// Deadlock possible!
```

```
Timeline:
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
T1: lock(A) тЬУ     |
T2:               | lock(B) тЬУ
T1: lock(B) тЖТ wait (B held by T2)
T2: lock(A) тЖТ wait (A held by T1)

DEADLOCK!
```

---

## ЁЯУК Deadlock vs Starvation vs Livelock

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                                                              тФВ
тФВ  DEADLOCK                                                    тФВ
тФВ  тАв рж╕ржм process blocked                                        тФВ
тФВ  тАв ржХрзЛржирзЛ progress ржирзЗржЗ                                        тФВ
тФВ  тАв External intervention ржЫрж╛ржбрж╝рж╛ solve рж╣ржпрж╝ ржирж╛                  тФВ
тФВ                                                              тФВ
тФВ  STARVATION                                                  тФВ
тФВ  тАв ржХрж┐ржЫрзБ process progress ржХрж░рзЗ                                тФВ
тФВ  тАв ржПржХржЯрж┐ process indefinitely wait ржХрж░рзЗ                       тФВ
тФВ  тАв Eventually solve рж╣рждрзЗ ржкрж╛рж░рзЗ                                тФВ
тФВ                                                              тФВ
тФВ  LIVELOCK                                                    тФВ
тФВ  тАв Processes running but no progress                         тФВ
тФВ  тАв Constantly changing state                                 тФВ
тФВ  тАв Example: ржжрзБржЗржЬржи corridor рждрзЗ ржПржХрзЗ ржЕржкрж░ржХрзЗ ржкрже ржжрж┐ржЪрзНржЫрзЗ          тФВ
тФВ                                                              тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### Livelock Example

```
Person A: тЖТ         Person B: тЖР
         Move right         Move left
         
Person A: тЖР         Person B: тЖТ
         Move left          Move right
         
Person A: тЖТ         Person B: тЖР
         Move right         Move left
         
... continues forever without making progress!
```

---

## ЁЯФз Deadlock Handling Strategies

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                                                             тФВ
тФВ  1. Prevention (ржкрзНрж░рждрж┐рж░рзЛржз)                                  тФВ
тФВ     тАв ржЪрж╛рж░ржЯрж┐ рж╢рж░рзНрждрзЗрж░ ржпрзЗржХрзЛржирзЛ ржПржХржЯрж┐ ржнрж╛ржЩрж╛                        тФВ
тФВ     тАв Deadlock рж╣рждрзЗржЗ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ ржирж╛                           тФВ
тФВ                                                             тФВ
тФВ  2. Avoidance (ржПржбрж╝рж╛ржирзЛ)                                     тФВ
тФВ     тАв Resource allocation рж╕ржоржпрж╝ check ржХрж░рж╛                   тФВ
тФВ     тАв Safe state ржерж╛ржХрж▓рзЗржЗ allocate ржХрж░рж╛                      тФВ
тФВ     тАв Banker's Algorithm                                    тФВ
тФВ                                                             тФВ
тФВ  3. Detection and Recovery (рж╕ржирж╛ржХрзНрждржХрж░ржг ржУ ржкрзБржирж░рзБржжрзНржзрж╛рж░)         тФВ
тФВ     тАв Deadlock рж╣рждрзЗ ржжрзЗржУржпрж╝рж╛                                   тФВ
тФВ     тАв Detect ржХрж░рзЗ recover ржХрж░рж╛                               тФВ
тФВ                                                             тФВ
тФВ  4. Ignore (ржЙржкрзЗржХрзНрж╖рж╛)                                       тФВ
тФВ     тАв Ostrich Algorithm                                     тФВ
тФВ     тАв UNIX/Linux ржП ржмрзНржпржмрж╣рзГржд                                  тФВ
тФВ     тАв Deadlock rare рж╣рж▓рзЗ ржПржЯрж╛ practical                      тФВ
тФВ                                                             тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯУИ System Model

### Resource Types

```
Resources (R):
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  тАв CPU cycles                                               тФВ
тФВ  тАв Memory space                                             тФВ
тФВ  тАв I/O devices (printers, drives)                           тФВ
тФВ  тАв Files                                                    тФВ
тФВ  тАв Semaphores, Mutexes                                      тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Resource Types vs Instances:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  Resource Type: Printer                                     тФВ
тФВ  Instances: Printer1, Printer2, Printer3                    тФВ
тФВ                                                             тФВ
тФВ  Resource Type: CPU                                         тФВ
тФВ  Instances: CPU0, CPU1 (in multi-core)                      тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### Process-Resource Interaction

```
Process                          Resource
   тФВ                                тФВ
   тФВ  Request                       тФВ
   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЦ║тФВ
   тФВ                                тФВ
   тФВ  Use (Allocate)                тФВ
   тФВтЧДтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
   тФВ                                тФВ
   тФВ  Release                       тФВ
   тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЦ║тФВ
   тФВ                                тФВ
```

---

## тЭУ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржкрзНрж░рж╢рзНржи

**ржкрзНрж░рж╢рзНржи рзз:** Deadlock ржПрж░ ржЪрж╛рж░ржЯрж┐ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рж╢рж░рзНржд ржХрж┐ ржХрж┐?
**ржЙрждрзНрждрж░:** Mutual Exclusion, Hold and Wait, No Preemption, Circular Wait

**ржкрзНрж░рж╢рзНржи рзи:** Deadlock ржУ Starvation ржПрж░ ржкрж╛рж░рзНржержХрзНржп ржХрж┐?
**ржЙрждрзНрждрж░:**
- Deadlock: рж╕ржм involved process blocked, ржХрзЛржирзЛ progress ржирзЗржЗ
- Starvation: ржПржХржЯрж┐ process indefinitely wait ржХрж░рзЗ ржХрж┐ржирзНрждрзБ ржЕржирзНржпрж░рж╛ progress ржХрж░рзЗ

**ржкрзНрж░рж╢рзНржи рзй:** ржХрзЛржи рж╢рж░рзНржд ржнрж╛ржЩрж▓рзЗ Deadlock рж╣ржмрзЗ ржирж╛?
**ржЙрждрзНрждрж░:** ржпрзЗржХрзЛржирзЛ ржПржХржЯрж┐ рж╢рж░рзНржд ржнрж╛ржЩрж▓рзЗржЗ Deadlock рж╣ржмрзЗ ржирж╛ ржХрж╛рж░ржг ржЪрж╛рж░ржЯрж┐ рж╢рж░рзНржд ржПржХрж╕рж╛ржерзЗ ржерж╛ржХрждрзЗ рж╣ржпрж╝ред

---
**ржкрж░ржмрж░рзНрждрзА:** [Resource Allocation Graph](02-resource-allocation-graph.md)
