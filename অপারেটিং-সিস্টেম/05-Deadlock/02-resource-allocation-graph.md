# Resource Allocation Graph (à¦°à¦¿à¦¸à§‹à¦°à§à¦¸ à¦¬à¦°à¦¾à¦¦à§à¦¦ à¦—à§à¦°à¦¾à¦«)

## ğŸ“Œ RAG à¦•à¦¿?

**Resource Allocation Graph (RAG)** à¦¹à¦²à§‹ à¦à¦•à¦Ÿà¦¿ directed graph à¦¯à¦¾ system à¦à¦° resource allocation state à¦¦à§‡à¦–à¦¾à¦¯à¦¼à¥¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Graph Components                         â”‚
â”‚                                                             â”‚
â”‚   Process (P):        Resource (R):         Instance:       â”‚
â”‚      â”Œâ”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚      â”‚   â”‚              â”‚   â—   â”‚            â”‚  â—â—â—  â”‚     â”‚
â”‚      â”‚ P â”‚              â”‚   R   â”‚            â”‚  R    â”‚     â”‚
â”‚      â”‚   â”‚              â”‚       â”‚            â”‚(3ê°œ)  â”‚     â”‚
â”‚      â””â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚     (Circle)            (Rectangle)        (Multiple â—)    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· Edge Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  Request Edge (Pi â†’ Rj):                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚    Pi à¦šà¦¾à¦¯à¦¼ Rj                                               â”‚
â”‚                                                             â”‚
â”‚      â”Œâ”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚      â”‚ P â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   R   â”‚                      â”‚
â”‚      â””â”€â”€â”€â”˜   "wants"        â””â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚  Assignment Edge (Rj â†’ Pi):                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚    Rj assigned to Pi                                        â”‚
â”‚                                                             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”                          â”‚
â”‚      â”‚   R   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ P â”‚                          â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜   "held by"  â””â”€â”€â”€â”˜                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ RAG à¦‰à¦¦à¦¾à¦¹à¦°à¦£

### No Deadlock

```
              R1                R2
           â”Œâ”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”
           â”‚  â—   â”‚          â”‚  â—â—  â”‚
           â””â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚ â•²
              â”‚                 â”‚  â•²
              â–¼                 â–¼   â•²
           â”Œâ”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”  â–¼
           â”‚ P1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ P2 â”‚  â”Œâ”€â”€â”€â”€â”
           â””â”€â”€â”€â”€â”˜   (wants)  â””â”€â”€â”€â”€â”˜  â”‚ P3 â”‚
                              R1     â””â”€â”€â”€â”€â”˜

R1 â†’ P1 (P1 holds R1)
R2 â†’ P2 (P2 holds one instance of R2)
R2 â†’ P3 (P3 holds one instance of R2)
P2 â†’ R1 (P2 wants R1)

No cycle â†’ No Deadlock âœ“
P1 finishes â†’ releases R1 â†’ P2 can proceed
```

### Deadlock

```
              R1                R2
           â”Œâ”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”
           â”‚  â—   â”‚          â”‚  â—   â”‚
           â””â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
              â”‚                 â”‚
              â–¼                 â–¼
           â”Œâ”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”
           â”‚ P1 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ P2 â”‚
           â””â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”˜
              â”‚                 â–²
              â”‚                 â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

R1 â†’ P1 (P1 holds R1)
R2 â†’ P2 (P2 holds R2)
P1 â†’ R2 (P1 wants R2)
P2 â†’ R1 (P2 wants R1)

Cycle: P1 â†’ R2 â†’ P2 â†’ R1 â†’ P1
DEADLOCK! âœ—
```

---

## ğŸ” Cycle à¦à¦¬à¦‚ Deadlock

### Rule

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  Single Instance Resources:                                 â”‚
â”‚  â€¢ Cycle = Deadlock                                        â”‚
â”‚  â€¢ No cycle = No Deadlock                                  â”‚
â”‚                                                             â”‚
â”‚  Multiple Instance Resources:                               â”‚
â”‚  â€¢ Cycle â†’ Deadlock possible (but not guaranteed)          â”‚
â”‚  â€¢ No cycle â†’ No Deadlock                                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multiple Instance Example (Cycle but No Deadlock)

```
                 R1 (2 instances)
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    â—   â—    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               /     â”‚     \
              /      â”‚      \
             â–¼       â”‚       â–¼
          â”Œâ”€â”€â”€â”€â”     â”‚    â”Œâ”€â”€â”€â”€â”
          â”‚ P1 â”‚     â”‚    â”‚ P3 â”‚
          â””â”€â”€â”€â”€â”˜     â”‚    â””â”€â”€â”€â”€â”˜
             â”‚       â”‚       
             â”‚       â–¼       
             â”‚    â”Œâ”€â”€â”€â”€â”     
             â””â”€â”€â”€â–ºâ”‚ P2 â”‚     
           wants  â””â”€â”€â”€â”€â”˜     

R1 â†’ P1, R1 â†’ P3 (both hold R1 instances)
P1 â†’ R1 (P1 wants another R1)
P2 â†’ R1 (P2 wants R1)

Cycle: P1 â†’ R1 â†’ P1? NO!
But: P2 â†’ R1 â†’ ? (waiting)

No Deadlock because:
P3 can finish â†’ releases R1 â†’ P1 or P2 can get it
```

### Multiple Instance (Deadlock)

```
              R1 (2 instances)    R2 (2 instances)
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   â—  â—   â”‚        â”‚   â—  â—   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚â•²                  â•±â”‚
                  â”‚ â•²                â•± â”‚
                  â–¼  â•²              â•±  â–¼
               â”Œâ”€â”€â”€â”€â” â•²            â•± â”Œâ”€â”€â”€â”€â”
               â”‚ P1 â”‚  â•²          â•±  â”‚ P2 â”‚
               â””â”€â”€â”€â”€â”˜   â•²        â•±   â””â”€â”€â”€â”€â”˜
                  â”‚      â•²      â•±      â”‚
                  â”‚       â–¼    â–¼       â”‚
                  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                  â””â”€â”€â”€â”€â–ºâ”‚   P3   â”‚â—„â”€â”€â”€â”€â”˜
             wants R2   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  wants R1

Cycle exists AND all instances are allocated
â†’ DEADLOCK!
```

---

## ğŸ“ RAG to Wait-For Graph

### Multiple Instance à¦ Deadlock Detection

```
Resource Allocation Graph        Wait-For Graph
                                 (Remove resources)
     â”Œâ”€â”€â”€â”                          â”Œâ”€â”€â”€â”
     â”‚ R â”‚                          â”‚   â”‚
     â””â”€â”€â”€â”˜                          â””â”€â”€â”€â”˜
    â•±     â•²                           
   â–¼       â–²                        â”Œâ”€â”€â”€â”      â”Œâ”€â”€â”€â”
â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”                      â”‚P1 â”‚â”€â”€â”€â”€â”€â–ºâ”‚P2 â”‚
â”‚P1 â”‚â”€â”€â”€â–ºâ”‚P2 â”‚                      â””â”€â”€â”€â”˜      â””â”€â”€â”€â”˜
â””â”€â”€â”€â”˜    â””â”€â”€â”€â”˜                         â–²          â”‚
                                        â”‚          â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Wait-For Graph à¦ cycle = Deadlock
```

---

## ğŸ’» Algorithm: Cycle Detection

```c
// DFS-based cycle detection
bool visited[MAX_PROCESSES];
bool recStack[MAX_PROCESSES];  // Recursion stack

bool hasCycle(int node, int graph[][MAX]) {
    visited[node] = true;
    recStack[node] = true;
    
    for (int i = 0; i < n; i++) {
        if (graph[node][i]) {
            if (!visited[i] && hasCycle(i, graph))
                return true;
            else if (recStack[i])
                return true;  // Back edge found
        }
    }
    
    recStack[node] = false;
    return false;
}

bool detectDeadlock() {
    memset(visited, false, sizeof(visited));
    memset(recStack, false, sizeof(recStack));
    
    for (int i = 0; i < n; i++) {
        if (!visited[i] && hasCycle(i, graph))
            return true;
    }
    return false;
}
```

---

## ğŸ“Š RAG Summary Table

| Condition | Single Instance | Multiple Instance |
|-----------|-----------------|-------------------|
| No Cycle | No Deadlock | No Deadlock |
| Cycle | Deadlock âœ“ | May or may not be Deadlock |

---

## â“ à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ à¦ªà§à¦°à¦¶à§à¦¨

**à¦ªà§à¦°à¦¶à§à¦¨ à§§:** RAG à¦ Request Edge à¦à¦¬à¦‚ Assignment Edge à¦à¦° à¦ªà¦¾à¦°à§à¦¥à¦•à§à¦¯ à¦•à¦¿?
**à¦‰à¦¤à§à¦¤à¦°:**
- Request Edge: Process â†’ Resource (à¦šà¦¾à¦¯à¦¼)
- Assignment Edge: Resource â†’ Process (à¦ªà§‡à¦¯à¦¼à§‡à¦›à§‡)

**à¦ªà§à¦°à¦¶à§à¦¨ à§¨:** Multiple instance à¦ cycle à¦¥à¦¾à¦•à¦²à§‡à¦“ Deadlock à¦¨à¦¾ à¦¹à¦¤à§‡ à¦ªà¦¾à¦°à§‡ à¦•à§‡à¦¨?
**à¦‰à¦¤à§à¦¤à¦°:** à¦•à¦¾à¦°à¦£ cycle à¦ à¦¨à¦¾ à¦¥à¦¾à¦•à¦¾ à¦•à§‹à¦¨à§‹ process resource release à¦•à¦°à¦²à§‡ cycle à¦­à§‡à¦™à§‡ à¦¯à§‡à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤

**à¦ªà§à¦°à¦¶à§à¦¨ à§©:** Wait-For Graph à¦•à¦–à¦¨ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¾ à¦¹à¦¯à¦¼?
**à¦‰à¦¤à§à¦¤à¦°:** Multiple instance resource à¦ deadlock detection à¦à¦° à¦œà¦¨à§à¦¯à¥¤ à¦à¦¤à§‡ à¦¶à§à¦§à§ process à¦—à§à¦²à§‹ à¦¥à¦¾à¦•à§‡ à¦à¦¬à¦‚ edge à¦®à¦¾à¦¨à§‡ "waiting for"à¥¤

---
**à¦ªà§‚à¦°à§à¦¬à¦¬à¦°à§à¦¤à§€:** [Deadlock Basics](01-deadlock-basics.md)  
**à¦ªà¦°à¦¬à¦°à§à¦¤à§€:** [Deadlock Prevention](03-prevention.md)
