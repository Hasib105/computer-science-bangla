# QoS - Quality of Service

## 📖 QoS কী?

**QoS (Quality of Service)** হলো network traffic কে **prioritize** করার technique, যেন গুরুত্বপূর্ণ traffic (voice, video) সবার আগে process হয়।

```
Without QoS:                    With QoS:

All traffic equal:              Prioritized:

  Downloads ══════╗             🔴 Voice (Highest)  ════╗
  Voice     ══════╬═→ Slow!     🟠 Video             ═══╬═→ Smooth!
  Video     ══════╝             🟢 Downloads (Low)   ═══╝
  
  Voice/Video suffers!          Critical traffic first!
```

---

## 🤔 QoS কেন দরকার?

### Network Congestion Problem

```
Bandwidth Pipe:

                ┌─────────────────────────────────┐
Incoming        │                                 │        Outgoing
Traffic ═══════►│    100 Mbps Bandwidth           │═══════► 
(150 Mbps)      │                                 │        (100 Mbps)
                └─────────────────────────────────┘
                              │
                              ▼
                    50 Mbps dropped/delayed!
                    
Without QoS: Random packets dropped
With QoS: Low-priority packets dropped first
```

### Application Requirements

| Application | Latency | Jitter | Packet Loss | Priority |
|-------------|---------|--------|-------------|----------|
| VoIP | <150ms | <30ms | <1% | 🔴 Highest |
| Video Call | <200ms | <50ms | <1% | 🔴 High |
| Live Stream | <300ms | <100ms | <2% | 🟠 Medium |
| Web Browse | Flexible | Flexible | Flexible | 🟡 Normal |
| File Download | Any | Any | Retry | 🟢 Low |
| Backup | Any | Any | Retry | 🟢 Lowest |

---

## 📊 QoS এর মূল ধারণা

### ১. Bandwidth (ব্যান্ডউইডথ)

```
Total available capacity

100 Mbps pipe:
├── Voice:     10 Mbps guaranteed
├── Video:     30 Mbps guaranteed  
├── Web:       40 Mbps best-effort
└── Downloads: 20 Mbps remainder
```

### ২. Latency (বিলম্ব)

```
Latency = এক প্রান্ত থেকে অন্য প্রান্তে যেতে সময়

Sender ──────────────────────────► Receiver
        │← 50ms latency (delay) →│

Voice এ 150ms এর বেশি হলে:
কথা বলতে অসুবিধা হয়!
```

### ৩. Jitter (জিটার)

```
Jitter = Latency এর variation

Consistent (Low Jitter):        Inconsistent (High Jitter):
Packet 1: 50ms                  Packet 1: 30ms
Packet 2: 51ms                  Packet 2: 80ms ← Late!
Packet 3: 49ms                  Packet 3: 20ms
Packet 4: 50ms                  Packet 4: 100ms ← Very late!

                                Voice sounds choppy!
```

### ৪. Packet Loss

```
Packet Loss = কিছু packets পথে হারিয়ে যায়

Sent:     1, 2, 3, 4, 5, 6, 7, 8, 9, 10
Received: 1, 2,    4, 5, 6,    8, 9, 10
               ↑           ↑
            Packet 3     Packet 7
              Lost!       Lost!

Video: Artifacts দেখা যায়
Voice: Words missing
```

---

## ⚙️ QoS Mechanisms

### ১. Classification (শ্রেণীবিভাগ)

Traffic কে identify এবং categorize করা।

```
Packet Classification Methods:

┌────────────────────────────────────────────────────┐
│                                                     │
│  By Port:                                          │
│  ├── Port 80/443 → Web traffic                     │
│  ├── Port 5060 → SIP (VoIP signaling)             │
│  └── Port 3389 → RDP                              │
│                                                     │
│  By IP:                                            │
│  ├── 10.1.1.0/24 → Executive subnet (high)        │
│  └── 10.1.2.0/24 → Guest subnet (low)             │
│                                                     │
│  By Protocol:                                      │
│  ├── RTP → Real-time (high)                        │
│  └── BitTorrent → P2P (low)                        │
│                                                     │
│  By DSCP marking (see below)                       │
│                                                     │
└────────────────────────────────────────────────────┘
```

### ২. Marking (চিহ্নিতকরণ)

Packets এ priority tag লাগানো।

```
DSCP (Differentiated Services Code Point):

IP Header:
┌────────────────────────────────────────┐
│  ...  │ DSCP (6 bits) │ ECN │  ...    │
└────────────────────────────────────────┘
         ↑
    Priority marking

Common DSCP Values:
┌──────────┬─────────┬────────────────────┐
│ DSCP     │ Value   │ Traffic Type       │
├──────────┼─────────┼────────────────────┤
│ EF       │ 46      │ Voice (Expedited)  │
│ AF41     │ 34      │ Video conferencing │
│ AF31     │ 26      │ Streaming video    │
│ AF21     │ 18      │ Important data     │
│ BE       │ 0       │ Best Effort        │
└──────────┴─────────┴────────────────────┘
```

### ৩. Queuing (সারিবদ্ধকরণ)

Marked packets কে different queues এ রাখা।

```
Multiple Queues:

                  ┌───────────────────┐
                  │   Priority Queue  │──→ Always first
                  │   (Voice - EF)    │
                  └───────────────────┘
                           ↓
Incoming    ──→   ┌───────────────────┐
Packets           │   High Queue      │──→ Second
                  │   (Video - AF4x)  │
                  └───────────────────┘
                           ↓
                  ┌───────────────────┐
                  │   Normal Queue    │──→ Third
                  │   (Web - AF2x)    │
                  └───────────────────┘
                           ↓
                  ┌───────────────────┐
                  │   Low Queue       │──→ Last
                  │   (Downloads - BE)│
                  └───────────────────┘
```

### Queuing Algorithms

```
┌─────────────────────────────────────────────────────────┐
│              Common Queuing Methods                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  FIFO (First In First Out):                             │
│  সবাই একই queue এ, আগে আসলে আগে পাবে                    │
│  No priority - default behavior                         │
│                                                          │
│  Priority Queuing (PQ):                                 │
│  High priority queue খালি না হলে low process হয় না     │
│  ⚠️ Low priority starve করতে পারে!                     │
│                                                          │
│  Weighted Fair Queuing (WFQ):                           │
│  সবাই share পায়, weight অনুযায়ী বেশি/কম               │
│  Fair distribution                                      │
│                                                          │
│  Class-Based WFQ (CBWFQ):                               │
│  Custom classes বানানো যায়                              │
│  Enterprise standard                                    │
│                                                          │
│  Low Latency Queuing (LLQ):                             │
│  CBWFQ + Priority Queue for voice                       │
│  Best for VoIP environments                             │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🚦 Traffic Shaping vs Policing

### Traffic Policing (Drop)

```
Limit exceeded = DROP extra packets

          Rate Limit: 10 Mbps
               │
Incoming ═════►│═════════════► Allowed (≤10 Mbps)
(15 Mbps)      │
               └──────────────► Dropped (5 Mbps)

Hard limit, immediate drop
Used: Network edge, SLA enforcement
```

### Traffic Shaping (Buffer & Delay)

```
Limit exceeded = BUFFER and send later

          Rate Limit: 10 Mbps
               │    ┌────────┐
Incoming ═════►│═══►│ Buffer │═══► Smooth output (10 Mbps)
(Bursty)       │    └────────┘
               │         │
               │    Extra packets
               │    delayed, not dropped

Smooth traffic flow
Used: WAN links, avoiding drops
```

| Aspect | Policing | Shaping |
|--------|----------|---------|
| Excess traffic | Drops | Buffers |
| Latency | No added | Adds delay |
| Buffer | No | Yes |
| Burst handling | Poor | Good |
| Use case | Ingress | Egress |

---

## 🎯 QoS Design Example

### Enterprise Network

```
┌─────────────────────────────────────────────────────────┐
│                  QoS Policy Example                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Total Bandwidth: 100 Mbps WAN link                     │
│                                                          │
│  ┌────────────────────────────────────────────────┐     │
│  │ Voice (EF)          │ 10%  │ 10 Mbps │ Priority│     │
│  ├─────────────────────┼──────┼─────────┼─────────┤     │
│  │ Video Conferencing  │ 20%  │ 20 Mbps │ High    │     │
│  ├─────────────────────┼──────┼─────────┼─────────┤     │
│  │ Business Apps       │ 30%  │ 30 Mbps │ Medium  │     │
│  ├─────────────────────┼──────┼─────────┼─────────┤     │
│  │ Web Browsing        │ 25%  │ 25 Mbps │ Normal  │     │
│  ├─────────────────────┼──────┼─────────┼─────────┤     │
│  │ Best Effort/Other   │ 15%  │ 15 Mbps │ Low     │     │
│  └────────────────────────────────────────────────┘     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 💻 QoS Commands (Cisco Example)

```
! Create class maps (classification)
class-map match-any VOICE
  match protocol rtp
  match dscp ef
  
class-map match-any VIDEO
  match protocol rtsp
  match dscp af41

class-map match-any BUSINESS
  match access-group name BUSINESS-APPS

! Create policy map (action)
policy-map WAN-QOS
  class VOICE
    priority percent 10
  class VIDEO
    bandwidth percent 20
  class BUSINESS
    bandwidth percent 30
  class class-default
    fair-queue

! Apply to interface
interface GigabitEthernet0/1
  service-policy output WAN-QOS
```

---

## 🏠 Home Router QoS

```
Most home routers have basic QoS:

┌─────────────────────────────────────────────┐
│           Router QoS Settings                │
├─────────────────────────────────────────────┤
│                                              │
│  Priority Mode:                              │
│  ○ Gaming                                    │
│  ○ Streaming                                 │
│  ● Work from Home                            │
│  ○ Custom                                    │
│                                              │
│  Device Priority:                            │
│  ┌────────────────────────────────────────┐  │
│  │ Work Laptop     │ High    │ ▲ ▼       │  │
│  │ Smart TV        │ Medium  │ ▲ ▼       │  │
│  │ Kid's Tablet    │ Low     │ ▲ ▼       │  │
│  └────────────────────────────────────────┘  │
│                                              │
│  Application Priority:                       │
│  ┌────────────────────────────────────────┐  │
│  │ Zoom/Teams      │ High               │  │
│  │ Netflix         │ Medium             │  │
│  │ Downloads       │ Low                │  │
│  └────────────────────────────────────────┘  │
│                                              │
└─────────────────────────────────────────────┘
```

---

## 📊 QoS Monitoring

### Key Metrics to Monitor

```
┌─────────────────────────────────────────────────────────┐
│                QoS Monitoring                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Interface Statistics:                                  │
│  • Input/Output rate                                    │
│  • Drops per queue                                      │
│  • Queue depths                                         │
│                                                          │
│  Voice Metrics:                                         │
│  • MOS Score (Mean Opinion Score): 4.0+ good           │
│  • Jitter: <30ms for VoIP                              │
│  • Latency: <150ms one-way                             │
│  • Packet loss: <1%                                    │
│                                                          │
│  Commands:                                              │
│  show policy-map interface                              │
│  show class-map                                         │
│  show queue                                             │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## ✏️ অনুশীলনী

### ১. Match করুন
```
Latency      →  ?
Jitter       →  ?
Packet Loss  →  ?
Bandwidth    →  ?

Options:
a) কিছু data হারিয়ে যায়
b) মোট capacity
c) Delay এর variation
d) এক প্রান্ত থেকে অন্য প্রান্তে সময়
```

### ২. Priority দিন
```
এই applications কে High/Medium/Low priority দিন:

a) Video conference call
b) Large file backup
c) Online banking
d) Software update download
e) VoIP call
f) Social media browsing
```

### ৩. Scenario
```
আপনার office এ:
- 50 Mbps internet
- 20 জন employee
- VoIP phone system
- Video meetings
- Cloud ERP application

QoS policy design করুন:
- কতটুকু bandwidth কাকে?
- Priority order?
```

---

## 🎓 মনে রাখুন

```
QoS = Right traffic, Right time

Key Points:
✓ Voice needs low latency + low jitter
✓ Video needs bandwidth + low loss
✓ Data can tolerate delay

Steps:
1. Classify traffic
2. Mark packets (DSCP)
3. Queue appropriately
4. Shape/Police as needed
```

---

**🔙 [পূর্ববর্তী: Load Balancing](./??-???-???????????.md)** | **🔜 [পরবর্তী: SDN এবং NFV](./??-??????-??????.md)**


