# TCP এবং UDP প্রোটোকল

## 📖 Transport Layer Protocols

**TCP** এবং **UDP** হলো Transport Layer (Layer 4) এর দুটি মূল protocol যা applications এর মধ্যে data transfer করে।

```
Application Layer
       │
       ↓
┌──────────────────────────────┐
│     Transport Layer          │
│  ┌──────────┐ ┌──────────┐  │
│  │   TCP    │ │   UDP    │  │
│  │Reliable  │ │  Fast    │  │
│  │Connected │ │Connectionless│
│  └──────────┘ └──────────┘  │
└──────────────────────────────┘
       │
       ↓
Network Layer (IP)
```

---

## 🔗 TCP (Transmission Control Protocol)

### TCP কী?

**TCP** হলো **connection-oriented, reliable** protocol যা data সঠিকভাবে এবং সঠিক order এ deliver করা guarantee করে।

```
┌─────────────────────────────────────────────────────────┐
│                  TCP Features                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ✓ Connection-oriented (connection আগে establish)       │
│  ✓ Reliable delivery (lost packet re-send)              │
│  ✓ Ordered delivery (সঠিক sequence)                     │
│  ✓ Error checking (checksum)                            │
│  ✓ Flow control (receiver overwhelm না করা)             │
│  ✓ Congestion control (network চাপ কমানো)               │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### TCP Header

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├───────────────────────────────┬───────────────────────────────┤
│         Source Port           │       Destination Port        │
├───────────────────────────────┴───────────────────────────────┤
│                        Sequence Number                         │
├───────────────────────────────────────────────────────────────┤
│                    Acknowledgment Number                       │
├───────┬───────┬─┬─┬─┬─┬─┬─┬───────────────────────────────────┤
│Data   │       │U│A│P│R│S│F│                                   │
│Offset │ Res   │R│C│S│S│Y│I│            Window                 │
│       │       │G│K│H│T│N│N│                                   │
├───────┴───────┴─┴─┴─┴─┴─┴─┼───────────────────────────────────┤
│         Checksum          │         Urgent Pointer            │
├───────────────────────────┴───────────────────────────────────┤
│                    Options (if any)                           │
├───────────────────────────────────────────────────────────────┤
│                          Data                                 │
└───────────────────────────────────────────────────────────────┘

Header Size: 20 bytes (minimum)
```

### Important TCP Flags

| Flag | Name | Purpose |
|------|------|---------|
| SYN | Synchronize | Connection শুরু |
| ACK | Acknowledge | Receipt confirm |
| FIN | Finish | Connection শেষ |
| RST | Reset | Connection reset |
| PSH | Push | Data immediately process |
| URG | Urgent | Urgent data |

---

## 🤝 TCP Three-Way Handshake

Connection establish করার process:

```
     Client                              Server
        │                                   │
        │ ──────── SYN (seq=100) ────────→ │
        │     "I want to connect"           │
        │                                   │
        │ ←── SYN-ACK (seq=300, ack=101) ── │
        │   "OK, I acknowledge. I also      │
        │    want to sync with you"         │
        │                                   │
        │ ──────── ACK (ack=301) ─────────→ │
        │     "Acknowledged. Let's go!"     │
        │                                   │
        │ ═══════ CONNECTION ESTABLISHED ════│
        │                                   │
        │ ←───────── Data ─────────────→   │
        │                                   │

Step 1: SYN - Client says "Let's talk" (Seq=X)
Step 2: SYN-ACK - Server says "OK, let's talk" (Seq=Y, Ack=X+1)
Step 3: ACK - Client says "Agreed!" (Ack=Y+1)
```

### Connection Termination (Four-Way)

```
     Client                              Server
        │                                   │
        │ ──────── FIN ───────────────────→ │
        │     "I'm done sending"            │
        │                                   │
        │ ←─────── ACK ────────────────── │
        │     "OK, I heard you"             │
        │                                   │
        │ ←─────── FIN ────────────────── │
        │     "I'm also done"               │
        │                                   │
        │ ──────── ACK ───────────────────→ │
        │     "OK, goodbye!"                │
        │                                   │
        │ ═══════ CONNECTION CLOSED ═══════ │
```

---

## 📊 TCP Reliability Mechanisms

### Acknowledgments & Retransmission

```
Normal Case:
Client                              Server
   │ ────── Data (seq=1) ──────────→ │
   │ ←───── ACK (ack=2) ──────────── │  ✓ Received
   │ ────── Data (seq=2) ──────────→ │
   │ ←───── ACK (ack=3) ──────────── │  ✓ Received

Packet Loss:
Client                              Server
   │ ────── Data (seq=1) ──────────→ │
   │ ←───── ACK (ack=2) ──────────── │  ✓ Received
   │ ────── Data (seq=2) ────── ✗    │  Lost!
   │     (timeout, no ACK)            │
   │                                  │
   │ ────── Data (seq=2) ──────────→ │  Retransmit!
   │ ←───── ACK (ack=3) ──────────── │  ✓ Now received
```

### Flow Control (Sliding Window)

```
Window Size controls how much data can be "in flight"

Window = 3 packets

Sender                              Receiver
   │ ────── Pkt 1 ──────────────────→ │
   │ ────── Pkt 2 ──────────────────→ │  Window full
   │ ────── Pkt 3 ──────────────────→ │  (wait for ACK)
   │                                   │
   │ ←───── ACK 1 ───────────────────│
   │ ────── Pkt 4 ──────────────────→ │  Window slides
   │ ←───── ACK 2 ───────────────────│
   │ ────── Pkt 5 ──────────────────→ │
   ...

Receiver can say: "Slow down!" (Window=1)
                  "Speed up!"  (Window=10)
```

---

## 📡 UDP (User Datagram Protocol)

### UDP কী?

**UDP** হলো **connectionless, unreliable** কিন্তু **fast** protocol।

```
┌─────────────────────────────────────────────────────────┐
│                  UDP Features                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ✓ Connectionless (connection ছাড়াই send)              │
│  ✓ No reliability (lost হলে re-send নেই)               │
│  ✓ No ordering (any order এ আসতে পারে)                 │
│  ✓ No flow control                                      │
│  ✓ Fast! (কম overhead)                                  │
│  ✓ Low latency                                          │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### UDP Header

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├───────────────────────────────┬───────────────────────────────┤
│         Source Port           │       Destination Port        │
├───────────────────────────────┼───────────────────────────────┤
│            Length             │           Checksum            │
├───────────────────────────────┴───────────────────────────────┤
│                          Data                                 │
└───────────────────────────────────────────────────────────────┘

Header Size: 8 bytes only! (TCP: 20 bytes)
Simple and fast!
```

### UDP Communication

```
UDP "Fire and Forget":

Client                              Server
   │                                   │
   │ ────── Data ─────────────────→   │
   │     (No connection setup)         │
   │     (No acknowledgment)           │
   │                                   │
   │ ────── Data ─────────────────→   │
   │                                   │
   │ ────── Data ──── ✗               │  Lost? 
   │     (No retransmission!)          │  Application handles!
   │                                   │

Simple, fast, but unreliable
Application must handle reliability if needed
```

---

## 🆚 TCP vs UDP তুলনা

```
┌────────────────────────────────────────────────────────────┐
│                  TCP vs UDP                                 │
├──────────────────┬─────────────────┬───────────────────────┤
│     Feature      │      TCP        │        UDP            │
├──────────────────┼─────────────────┼───────────────────────┤
│ Connection       │ Connection-     │ Connectionless        │
│                  │ oriented        │                       │
├──────────────────┼─────────────────┼───────────────────────┤
│ Reliability      │ Reliable        │ Unreliable            │
│                  │ (ACK, Retx)     │ (Best effort)         │
├──────────────────┼─────────────────┼───────────────────────┤
│ Ordering         │ Ordered         │ Unordered             │
├──────────────────┼─────────────────┼───────────────────────┤
│ Speed            │ Slower          │ Faster                │
├──────────────────┼─────────────────┼───────────────────────┤
│ Header Size      │ 20 bytes        │ 8 bytes               │
├──────────────────┼─────────────────┼───────────────────────┤
│ Flow Control     │ Yes (Window)    │ No                    │
├──────────────────┼─────────────────┼───────────────────────┤
│ Use Case         │ File transfer   │ Live streaming        │
│                  │ Web, Email      │ VoIP, Gaming          │
│                  │ SSH, Database   │ DNS queries           │
└──────────────────┴─────────────────┴───────────────────────┘
```

### When to Use What?

```
Use TCP when:                    Use UDP when:
┌─────────────────────┐         ┌─────────────────────┐
│ • Data must arrive  │         │ • Speed is critical │
│ • Order matters     │         │ • Some loss OK      │
│ • Complete transfer │         │ • Real-time needed  │
│                     │         │                     │
│ Examples:           │         │ Examples:           │
│ - HTTP/HTTPS        │         │ - Video streaming   │
│ - FTP               │         │ - VoIP              │
│ - Email (SMTP)      │         │ - Online gaming     │
│ - SSH               │         │ - DNS               │
│ - Database          │         │ - DHCP              │
└─────────────────────┘         └─────────────────────┘
```

---

## 🔌 Port Numbers

```
┌─────────────────────────────────────────────────────────┐
│              Port Number Ranges                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  0-1023:     Well-known ports (privileged)              │
│              HTTP(80), HTTPS(443), SSH(22), DNS(53)     │
│                                                          │
│  1024-49151: Registered ports                           │
│              MySQL(3306), RDP(3389)                     │
│                                                          │
│  49152-65535: Dynamic/Private ports                     │
│               Client source ports                       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Common Ports

| Port | Protocol | Service |
|------|----------|---------|
| 20,21 | TCP | FTP |
| 22 | TCP | SSH |
| 23 | TCP | Telnet |
| 25 | TCP | SMTP |
| 53 | TCP/UDP | DNS |
| 67,68 | UDP | DHCP |
| 80 | TCP | HTTP |
| 110 | TCP | POP3 |
| 143 | TCP | IMAP |
| 443 | TCP | HTTPS |
| 3306 | TCP | MySQL |
| 3389 | TCP | RDP |

---

## 💻 TCP/UDP Commands

### Check Connections (netstat/ss)

```cmd
# Windows - all TCP connections
netstat -an | findstr TCP

# Windows - specific port
netstat -an | findstr :80

# Windows - with process name
netstat -b

# Windows - with process ID
netstat -ano

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    192.168.1.100:52345   93.184.216.34:443     ESTABLISHED
  TCP    0.0.0.0:80            0.0.0.0:0              LISTENING
  UDP    0.0.0.0:53            *:*
```

```bash
# Linux - all connections
ss -an

# TCP only
ss -t

# UDP only
ss -u

# Listening ports with process
ss -tlnp

# Specific port
ss -an 'sport = :80 or dport = :80'
```

### Test Ports

```cmd
# Windows - test if port is open
Test-NetConnection google.com -Port 443

# Or using telnet
telnet google.com 80
```

```bash
# Linux - netcat
nc -zv google.com 80
nc -zv google.com 443

# Check UDP port
nc -zvu server.com 53
```

---

## 🔬 TCP States

```
TCP Connection States:

CLOSED        ─┐
              │ SYN sent
              ↓
SYN_SENT     ─┐
              │ SYN+ACK received
              ↓
ESTABLISHED  ─┐  ← Data transfer happens here
              │ FIN sent
              ↓
FIN_WAIT_1   ─┐
              │ ACK received
              ↓
FIN_WAIT_2   ─┐
              │ FIN received, ACK sent
              ↓
TIME_WAIT    ─┐  ← Waits 2*MSL before closing
              │
              ↓
CLOSED

Common states you'll see:
• LISTENING - Waiting for connection (servers)
• ESTABLISHED - Active connection
• TIME_WAIT - Recently closed (normal)
• CLOSE_WAIT - Waiting for app to close
```

---

## 🎮 Real-World Examples

### Web Browsing (TCP)

```
Your Browser                         Web Server
     │                                    │
     │ ─── SYN (connect) ───────────────→ │
     │ ←── SYN-ACK ──────────────────── │
     │ ─── ACK ─────────────────────────→ │
     │                                    │
     │ ─── HTTP GET / ──────────────────→ │
     │ ←── HTTP 200 OK + HTML ────────── │
     │ ←── (more data) ─────────────────│
     │ ─── ACK ─────────────────────────→ │
     │                                    │
     │ ─── FIN ─────────────────────────→ │
     │ ←── FIN-ACK ─────────────────────│
     │ ─── ACK ─────────────────────────→ │
```

### Video Streaming (UDP)

```
Streaming Server                      Your Player
     │                                    │
     │ ─── Video frame 1 ────────────→   │ Play
     │ ─── Video frame 2 ────────────→   │ Play
     │ ─── Video frame 3 ─── ✗ (lost)    │ Skip!
     │ ─── Video frame 4 ────────────→   │ Play
     │ ─── Audio chunk ──────────────→   │ Play
     │                                    │
     
No time to retransmit!
Better to skip a frame than freeze video
```

---

## ✏️ অনুশীলনী

### ১. সঠিক Protocol বাছুন
```
এই applications এ TCP নাকি UDP?

a) Online banking
b) Live cricket streaming
c) File download
d) Voice call (Zoom)
e) Email send
f) DNS query
g) Online gaming (FPS)
```

### ২. TCP Handshake
```
Three-way handshake এর steps বলুন:

Step 1: Client sends _____ flag
Step 2: Server responds with _____ flags
Step 3: Client sends _____ flag

Connection এখন _________
```

### ৩. Port Exercise
```
নিজের computer এ:

a) Open TCP connections দেখুন (netstat -an)
b) Port 443 এ কোন connections আছে?
c) কতগুলো ESTABLISHED state এ আছে?
```

---

## 🎓 মনে রাখুন

```
TCP = Reliable, ordered, slower
      "I want EVERY bit to arrive correctly"
      
UDP = Fast, simple, may lose data
      "Speed matters, some loss is OK"

TCP: Email, Web, File transfer
UDP: Video call, Gaming, DNS

Port = Address for applications
      Server listens, Client connects
```

---

**🔙 [পূর্ববর্তী: Network Design](../04-practical/??-?????????-??????.md)** | **🔜 [পরবর্তী: HTTP এবং HTTPS](./??-?????????-???????????.md)**


