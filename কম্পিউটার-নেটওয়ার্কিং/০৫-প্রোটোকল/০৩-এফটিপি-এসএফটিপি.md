# FTP এবং SFTP প্রোটোকল

## 📖 FTP কী?

**FTP (File Transfer Protocol)** হলো network এ file transfer করার standard protocol। ১৯৭১ সালে তৈরি, এখনো widely ব্যবহৃত।

```
┌─────────────────────────────────────────────────────────┐
│                  FTP Overview                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Purpose: File upload/download                          │
│  Port: 21 (control), 20 (data)                         │
│  Layer: Application Layer                               │
│  Mode: Active or Passive                                │
│  Security: ⚠️ Plain text (unencrypted)                  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 FTP Architecture

### Two Channels

```
FTP uses TWO separate connections:

┌────────────┐                        ┌────────────┐
│            │ ══ Control (Port 21) ══│            │
│   Client   │     Commands/Replies   │   Server   │
│            │                        │            │
│            │ ══ Data (Port 20) ═════│            │
│            │     File transfer      │            │
└────────────┘                        └────────────┘

Control Channel: Commands (login, ls, cd, get, put)
Data Channel: Actual file data transfer
```

### Active Mode

```
Active Mode (PORT command):

1. Client connects to server port 21
2. Client opens random port (e.g., 5000)
3. Client tells server: "Connect to my port 5000"
4. Server connects FROM port 20 TO client port 5000

Client                              Server
  │                                    │
  │ ───────── Connect :21 ──────────→ │
  │ ───────── PORT 5000 ─────────────→│
  │                                    │
  │ ←──────── Connect to :5000 ──────│ (from port 20)
  │ ←════════ Data Transfer ═════════│
  │                                    │

⚠️ Problem: Client's firewall often blocks incoming!
```

### Passive Mode (PASV)

```
Passive Mode (PASV command):

1. Client connects to server port 21
2. Client says: "PASV please"
3. Server opens random port (e.g., 3456)
4. Server tells client: "Connect to my port 3456"
5. Client connects TO server port 3456

Client                              Server
  │                                    │
  │ ───────── Connect :21 ──────────→ │
  │ ───────── PASV ──────────────────→│
  │ ←──────── "Use port 3456" ────── │
  │                                    │
  │ ───────── Connect :3456 ─────────→│
  │ ═════════ Data Transfer ═════════ │

✓ Works through client firewalls!
   (Client initiates both connections)
```

---

## 📋 FTP Commands

### Common Commands

```
┌─────────────────────────────────────────────────────────┐
│              FTP Commands                                │
├──────────┬──────────────────────────────────────────────┤
│ Command  │ Description                                  │
├──────────┼──────────────────────────────────────────────┤
│ open     │ Connect to FTP server                       │
│ user     │ Enter username                              │
│ pass     │ Enter password                              │
│ ls/dir   │ List files                                  │
│ cd       │ Change directory                            │
│ pwd      │ Show current directory                      │
│ get      │ Download file                               │
│ put      │ Upload file                                 │
│ mget     │ Download multiple files                     │
│ mput     │ Upload multiple files                       │
│ binary   │ Switch to binary mode                       │
│ ascii    │ Switch to ASCII mode                        │
│ delete   │ Delete file                                 │
│ mkdir    │ Create directory                            │
│ rmdir    │ Remove directory                            │
│ bye/quit │ Disconnect                                  │
└──────────┴──────────────────────────────────────────────┘
```

### FTP Session Example

```cmd
C:\> ftp ftp.example.com
Connected to ftp.example.com.
220 Welcome to FTP Server

User: john
331 Password required

Password: ****
230 Login successful

ftp> pwd
257 "/" is current directory

ftp> ls
drwxr-xr-x   2 john  users  4096 Jan 15 documents
-rw-r--r--   1 john  users  1234 Jan 10 readme.txt

ftp> cd documents
250 Directory changed

ftp> get report.pdf
200 PORT command successful
150 Opening data connection
226 Transfer complete
ftp: 102400 bytes received in 0.5 seconds

ftp> put newfile.txt
200 PORT command successful
150 Opening data connection
226 Transfer complete

ftp> bye
221 Goodbye
```

---

## ⚠️ FTP Security Issues

```
┌─────────────────────────────────────────────────────────┐
│              FTP Security Problems                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ✗ Plain text credentials                               │
│    Username/password visible to sniffers!               │
│                                                          │
│  ✗ Unencrypted data                                     │
│    File contents can be intercepted                     │
│                                                          │
│  ✗ No integrity check                                   │
│    Data can be modified in transit                      │
│                                                          │
│  ✗ Vulnerable to:                                       │
│    - Packet sniffing                                    │
│    - Man-in-the-middle attacks                          │
│    - Session hijacking                                  │
│                                                          │
│  Solution: Use SFTP, FTPS, or SCP instead!             │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Packet Capture Example

```
Plain FTP captured by Wireshark:

220 Welcome to FTP
USER john           ← Username visible!
331 Password required
PASS secret123      ← Password visible!
230 Login OK

All data READABLE by attackers!
```

---

## 🔐 FTPS (FTP Secure)

**FTPS** = FTP over SSL/TLS

```
┌─────────────────────────────────────────────────────────┐
│                     FTPS                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  FTPS = FTP + TLS/SSL encryption                        │
│                                                          │
│  Two modes:                                             │
│                                                          │
│  1. Explicit FTPS (FTPES):                              │
│     - Connect to port 21                                │
│     - Client requests: AUTH TLS                         │
│     - Then encrypted                                    │
│     - More compatible                                   │
│                                                          │
│  2. Implicit FTPS:                                      │
│     - Connect to port 990                               │
│     - Immediately encrypted                             │
│     - Less common now                                   │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🔒 SFTP কী?

**SFTP (SSH File Transfer Protocol)** হলো completely different protocol যা **SSH** এর উপর কাজ করে।

```
┌─────────────────────────────────────────────────────────┐
│                     SFTP                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  SFTP ≠ FTP over SSL                                    │
│  SFTP = Completely new protocol over SSH                │
│                                                          │
│  Port: 22 (same as SSH)                                 │
│  Encryption: Full SSH encryption                        │
│  Authentication: SSH keys or password                   │
│  Single connection (not two like FTP)                   │
│                                                          │
│  ✓ Fully encrypted                                      │
│  ✓ Secure authentication                                │
│  ✓ Firewall friendly (single port)                     │
│  ✓ File permissions preserved                          │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### SFTP vs FTP

```
FTP:                            SFTP:
┌──────────┐                   ┌──────────┐
│  Port 21 │ Control           │          │
│          │                   │  Port 22 │ Everything
│  Port 20 │ Data              │          │ encrypted
│ (+ more) │                   │          │ in one
└──────────┘                   └──────────┘
Unencrypted                    SSH encrypted
```

---

## 🆚 FTP vs FTPS vs SFTP

```
┌─────────────────────────────────────────────────────────────┐
│                  Comparison                                  │
├──────────────┬──────────────┬──────────────┬────────────────┤
│    Feature   │     FTP      │    FTPS      │    SFTP        │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Port         │ 21, 20       │ 21, 990      │ 22             │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Encryption   │ None ✗       │ TLS/SSL ✓    │ SSH ✓          │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Connections  │ Multiple     │ Multiple     │ Single         │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Firewall     │ Complex      │ Complex      │ Simple         │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Certificate  │ N/A          │ Required     │ Optional       │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Auth         │ User/Pass    │ User/Pass    │ Keys/Password  │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ Recommended? │ No ✗         │ OK △         │ Yes ✓          │
└──────────────┴──────────────┴──────────────┴────────────────┘
```

---

## 💻 SFTP Commands

### Using sftp client

```bash
# Connect to SFTP server
$ sftp user@server.example.com

# Or with specific port
$ sftp -P 2222 user@server.example.com

sftp> pwd           # Remote directory
sftp> lpwd          # Local directory

sftp> ls            # List remote files
sftp> lls           # List local files

sftp> cd /uploads   # Change remote directory
sftp> lcd ~/Desktop # Change local directory

sftp> get file.txt  # Download file
sftp> get -r folder # Download folder (recursive)

sftp> put local.txt # Upload file
sftp> put -r folder # Upload folder

sftp> rm file.txt   # Delete remote file
sftp> mkdir new     # Create remote directory

sftp> exit          # Disconnect
```

### Using SCP (Secure Copy)

```bash
# Download file
scp user@server:/path/to/file.txt ./local/

# Upload file
scp ./local/file.txt user@server:/path/to/destination/

# Copy entire folder
scp -r user@server:/remote/folder/ ./local/

# Using different port
scp -P 2222 file.txt user@server:/path/
```

---

## 🖥️ GUI FTP/SFTP Clients

```
┌─────────────────────────────────────────────────────────┐
│              Popular FTP/SFTP Clients                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Cross-platform:                                        │
│  ├── FileZilla (Free, FTP/FTPS/SFTP)                   │
│  ├── Cyberduck (Free, multi-protocol)                  │
│  └── WinSCP (Windows, SFTP/SCP)                        │
│                                                          │
│  Windows:                                               │
│  ├── WinSCP                                             │
│  └── Core FTP                                           │
│                                                          │
│  macOS:                                                 │
│  ├── Transmit                                           │
│  └── Forklift                                           │
│                                                          │
│  Linux:                                                 │
│  └── Nautilus/Dolphin (built-in)                       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### FileZilla Example

```
┌──────────────────────────────────────────────────────────┐
│ FileZilla                                          [X]   │
├──────────────────────────────────────────────────────────┤
│ Host: sftp://server.example.com  User: john  Pass: **** │
├──────────────────────────────────────────────────────────┤
│ Local Site          │ Remote Site                       │
│ ├── Desktop         │ ├── /home/john                    │
│ ├── Documents       │ │   ├── files/                    │
│ │   └── report.pdf  │ │   └── backup/                   │
│ └── Downloads       │ └──                               │
├──────────────────────────────────────────────────────────┤
│ Filename       Size     │ Filename       Size           │
│ report.pdf    1.2 MB    │ data.csv      500 KB          │
│ image.jpg     300 KB    │ logs.txt      100 KB          │
├──────────────────────────────────────────────────────────┤
│ Queued: 0 | Failed: 0 | Successful: 5                   │
└──────────────────────────────────────────────────────────┘

Drag & Drop to transfer files!
```

---

## 🔑 SSH Key Authentication for SFTP

### Generate SSH Keys

```bash
# Generate key pair
$ ssh-keygen -t ed25519 -C "your_email@example.com"

Generating public/private ed25519 key pair.
Enter file in which to save the key: (default)
Enter passphrase: (optional but recommended)

Your identification: ~/.ssh/id_ed25519
Your public key: ~/.ssh/id_ed25519.pub
```

### Setup Key-based Auth

```bash
# Copy public key to server
$ ssh-copy-id user@server.example.com

# Or manually:
# 1. Cat your public key
cat ~/.ssh/id_ed25519.pub

# 2. Add to server's ~/.ssh/authorized_keys

# Now SFTP without password!
$ sftp user@server.example.com
Connected!
sftp>
```

---

## ⚡ Transfer Mode: ASCII vs Binary

```
┌─────────────────────────────────────────────────────────┐
│              Transfer Modes                              │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ASCII Mode:                                            │
│  - For text files (.txt, .html, .csv)                   │
│  - Converts line endings (Windows ↔ Unix)               │
│  - Windows: CR+LF (\r\n)                                │
│  - Unix/Linux: LF (\n)                                  │
│                                                          │
│  Binary Mode:                                           │
│  - For non-text files (images, executables, zips)       │
│  - No conversion (exact copy)                           │
│  - Always safe to use                                   │
│                                                          │
│  Tip: When in doubt, use BINARY!                        │
│                                                          │
└─────────────────────────────────────────────────────────┘

ftp> binary
200 Type set to I (Image/Binary)

ftp> ascii
200 Type set to A (ASCII)
```

---

## 🏢 FTP Server Setup (Basic)

### Linux (vsftpd)

```bash
# Install
sudo apt install vsftpd

# Configure
sudo nano /etc/vsftpd.conf

# Key settings:
anonymous_enable=NO
local_enable=YES
write_enable=YES
chroot_local_user=YES

# Restart service
sudo systemctl restart vsftpd
sudo systemctl enable vsftpd
```

### Windows (IIS FTP)

```
1. Server Manager → Add Roles and Features
2. Select Web Server (IIS)
3. Include FTP Server
4. Configure FTP Site in IIS Manager
5. Set authentication and permissions
```

---

## ✏️ অনুশীলনী

### ১. FTP Concepts
```
a) FTP কয়টা port ব্যবহার করে?
b) Active vs Passive mode এর পার্থক্য কী?
c) কেন Passive mode বেশি ব্যবহৃত?
d) FTP নিরাপদ নয় কেন?
```

### ২. Protocol বাছুন
```
এই situations এ কোনটি use করবেন?

a) Legacy system, no encryption possible
b) Secure file transfer needed
c) Web hosting file upload
d) Automated backup scripts
```

### ৩. Hands-on
```
a) FileZilla download ও install করুন
b) একটি public FTP server এ connect করুন
   (ftp://ftp.gnu.org)
c) File list দেখুন
d) একটি small file download করুন
```

---

## 🎓 মনে রাখুন

```
FTP Family:
├── FTP  - Unencrypted ✗ (Avoid!)
├── FTPS - FTP + TLS △ (OK)
└── SFTP - SSH based ✓ (Best!)

Ports:
FTP:  21 (control), 20 (data)
FTPS: 990 (implicit) or 21 (explicit)
SFTP: 22 (SSH)

Golden Rule:
Never use plain FTP for sensitive data!
Always prefer SFTP when possible.
```

---

**🔙 [পূর্ববর্তী: HTTP এবং HTTPS](./??-?????????-???????????.md)** | **🔜 [পরবর্তী: Email Protocols](./??-?????-????????.md)**


