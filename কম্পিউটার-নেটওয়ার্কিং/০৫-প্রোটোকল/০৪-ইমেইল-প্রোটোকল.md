# Email Protocols (SMTP, POP3, IMAP)

## 📧 Email কীভাবে কাজ করে?

Email পাঠাতে এবং receive করতে **তিনটি main protocol** ব্যবহৃত হয়:

```
┌─────────────────────────────────────────────────────────┐
│              Email Protocol Overview                     │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  SMTP - Sending email     (Outgoing)                    │
│  POP3 - Receiving email   (Download & Delete)           │
│  IMAP - Receiving email   (Sync with server)            │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 📤 Email Journey

```
Sending an Email:

Sender                                            Receiver
  │                                                  │
  ▼                                                  │
┌──────────┐      SMTP       ┌──────────────┐       │
│ Email    │ ─────────────→  │   Sender's   │       │
│ Client   │                 │  Mail Server │       │
└──────────┘                 └──────┬───────┘       │
(Outlook,                          │               │
 Gmail)                            │ SMTP          │
                                   ▼               │
                           ┌──────────────┐        │
                           │  Receiver's  │        │
                           │  Mail Server │        │
                           └──────┬───────┘        │
                                  │                │
                     POP3 or IMAP │                │
                                  ▼                ▼
                           ┌──────────┐       ┌──────────┐
                           │ Receiver │   or  │  Webmail │
                           │ Client   │       │  (Gmail) │
                           └──────────┘       └──────────┘
```

---

## 📬 SMTP (Simple Mail Transfer Protocol)

**SMTP** শুধুমাত্র **email পাঠানোর** জন্য ব্যবহৃত।

### SMTP Basics

```
┌─────────────────────────────────────────────────────────┐
│                     SMTP                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Purpose: Send/relay email                              │
│                                                          │
│  Ports:                                                 │
│  ├── 25   - Server to server (often blocked)           │
│  ├── 587  - Client submission (with STARTTLS) ✓        │
│  └── 465  - SMTPS (implicit TLS)                        │
│                                                          │
│  Direction: Push protocol (sends to server)             │
│                                                          │
│  Commands: HELO, MAIL FROM, RCPT TO, DATA, QUIT        │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### SMTP Session

```
SMTP Communication (simplified):

Client                              Server
  │                                    │
  │ ─────── Connect to port 587 ─────→│
  │ ←────── 220 Welcome ──────────────│
  │                                    │
  │ ─────── EHLO client.com ─────────→│
  │ ←────── 250 Hello ────────────────│
  │                                    │
  │ ─────── AUTH LOGIN ──────────────→│
  │ ←────── 334 Username: ────────────│
  │ ─────── (base64 username) ───────→│
  │ ←────── 334 Password: ────────────│
  │ ─────── (base64 password) ───────→│
  │ ←────── 235 Authenticated ────────│
  │                                    │
  │ ─────── MAIL FROM:<a@x.com> ─────→│
  │ ←────── 250 OK ───────────────────│
  │                                    │
  │ ─────── RCPT TO:<b@y.com> ───────→│
  │ ←────── 250 OK ───────────────────│
  │                                    │
  │ ─────── DATA ────────────────────→│
  │ ←────── 354 Start mail input ─────│
  │ ─────── Subject: Hello            │
  │ ─────── (email body)              │
  │ ─────── . (dot = end) ───────────→│
  │ ←────── 250 Message accepted ─────│
  │                                    │
  │ ─────── QUIT ────────────────────→│
  │ ←────── 221 Bye ──────────────────│
```

### SMTP Commands

```
┌──────────────┬────────────────────────────────────────┐
│ Command      │ Description                            │
├──────────────┼────────────────────────────────────────┤
│ HELO/EHLO    │ Greeting (EHLO for extended)          │
│ AUTH         │ Authentication                         │
│ MAIL FROM    │ Sender's email address                │
│ RCPT TO      │ Recipient's email address             │
│ DATA         │ Start of message body                  │
│ QUIT         │ End session                            │
│ RSET         │ Reset session                          │
│ VRFY         │ Verify address (often disabled)       │
│ STARTTLS     │ Upgrade to encrypted connection       │
└──────────────┴────────────────────────────────────────┘
```

---

## 📥 POP3 (Post Office Protocol v3)

**POP3** হলো email **download** করার protocol। Email server থেকে local device এ নামিয়ে আনে।

### POP3 Basics

```
┌─────────────────────────────────────────────────────────┐
│                     POP3                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Purpose: Download email from server                    │
│                                                          │
│  Ports:                                                 │
│  ├── 110  - Plain (unencrypted) ✗                      │
│  └── 995  - POP3S (with SSL/TLS) ✓                     │
│                                                          │
│  Behavior: Download → Delete from server                │
│  (Can keep copy, but not default)                       │
│                                                          │
│  Best for: Single device, offline access                │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### How POP3 Works

```
POP3 Download Pattern:

    Mail Server                      Client
┌─────────────────┐              ┌──────────┐
│                 │              │          │
│ ┌─────┐ ┌─────┐│   Download   │ ┌─────┐  │
│ │Email││Email││ ───────────→  │ │Email│  │
│ │  1  ││  2  ││              │ │  1  │  │
│ └─────┘ └─────┘│              │ ├─────┤  │
│                 │              │ │Email│  │
│   (deleted     │              │ │  2  │  │
│    after       │              │ └─────┘  │
│    download)   │              │          │
└─────────────────┘              └──────────┘

⚠️ Emails exist ONLY on client after download!
```

### POP3 Session

```
POP3 Communication:

Client                              Server
  │                                    │
  │ ─────── Connect to port 995 ─────→│
  │ ←────── +OK POP3 server ready ────│
  │                                    │
  │ ─────── USER john ───────────────→│
  │ ←────── +OK ──────────────────────│
  │                                    │
  │ ─────── PASS secret123 ──────────→│
  │ ←────── +OK Logged in ────────────│
  │                                    │
  │ ─────── STAT ────────────────────→│
  │ ←────── +OK 2 5120 ───────────────│ (2 messages, 5120 bytes)
  │                                    │
  │ ─────── LIST ────────────────────→│
  │ ←────── 1 2048 ───────────────────│
  │ ←────── 2 3072 ───────────────────│
  │                                    │
  │ ─────── RETR 1 ──────────────────→│
  │ ←────── (email content) ──────────│
  │                                    │
  │ ─────── DELE 1 ──────────────────→│
  │ ←────── +OK Deleted ──────────────│
  │                                    │
  │ ─────── QUIT ────────────────────→│
```

### POP3 Commands

```
┌──────────────┬────────────────────────────────────────┐
│ Command      │ Description                            │
├──────────────┼────────────────────────────────────────┤
│ USER         │ Specify username                       │
│ PASS         │ Specify password                       │
│ STAT         │ Get mailbox status (count & size)     │
│ LIST         │ List messages with sizes              │
│ RETR n       │ Retrieve message n                     │
│ DELE n       │ Mark message n for deletion           │
│ RSET         │ Reset (unmark deletions)              │
│ TOP n x      │ Get first x lines of message n        │
│ QUIT         │ End session (apply deletions)         │
└──────────────┴────────────────────────────────────────┘
```

---

## 📨 IMAP (Internet Message Access Protocol)

**IMAP** হলো আধুনিক email access protocol। Server এ email রেখে **sync** করে।

### IMAP Basics

```
┌─────────────────────────────────────────────────────────┐
│                     IMAP                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Version: IMAP4rev1 (current)                           │
│                                                          │
│  Ports:                                                 │
│  ├── 143  - Plain (unencrypted) ✗                      │
│  └── 993  - IMAPS (with SSL/TLS) ✓                     │
│                                                          │
│  Behavior: Emails stay on server (sync)                 │
│                                                          │
│  Best for: Multiple devices, always connected           │
│                                                          │
│  Features:                                              │
│  ├── Folders (mailboxes)                                │
│  ├── Flags (read/unread, starred)                      │
│  ├── Search on server                                   │
│  └── Partial message download                           │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### How IMAP Works

```
IMAP Sync Pattern:

    Mail Server                      Multiple Clients
┌─────────────────┐              
│  INBOX          │              ┌──────────┐
│ ┌─────┐ ┌─────┐│   Sync ←→    │  Phone   │
│ │Email││Email││ ──────────    └──────────┘
│ │  1  ││  2  ││              
│ └─────┘ └─────┘│   Sync ←→    ┌──────────┐
│                 │ ──────────   │  Laptop  │
│  Sent           │              └──────────┘
│ ┌─────┐        │              
│ │Email│        │   Sync ←→    ┌──────────┐
│ │  3  │        │ ──────────   │  Webmail │
│ └─────┘        │              └──────────┘
└─────────────────┘              

✓ Same mailbox accessible everywhere!
✓ Changes sync to all devices!
```

### IMAP Folders

```
IMAP Mailbox Structure:

INBOX
├── Work
│   ├── Projects
│   └── Meetings
├── Personal
├── [Gmail]/
│   ├── Sent Mail
│   ├── Drafts
│   ├── Spam
│   └── Trash
└── Archives
    └── 2024

Each folder can be:
- Selected (opened)
- Searched
- Managed (create/delete/rename)
```

### IMAP vs POP3

```
┌────────────────┬─────────────────┬─────────────────────┐
│    Feature     │      POP3       │        IMAP         │
├────────────────┼─────────────────┼─────────────────────┤
│ Email storage  │ Downloaded      │ On server           │
│                │ to client       │                     │
├────────────────┼─────────────────┼─────────────────────┤
│ Multiple       │ ✗ No (separate  │ ✓ Yes (synced)      │
│ devices        │   copies)       │                     │
├────────────────┼─────────────────┼─────────────────────┤
│ Folders        │ ✗ Inbox only    │ ✓ Full folder       │
│                │                 │   support           │
├────────────────┼─────────────────┼─────────────────────┤
│ Offline        │ ✓ Full access   │ △ Limited           │
│                │                 │   (cached only)     │
├────────────────┼─────────────────┼─────────────────────┤
│ Bandwidth      │ High (full      │ Low (headers first) │
│                │ download)       │                     │
├────────────────┼─────────────────┼─────────────────────┤
│ Server space   │ ✓ Freed after   │ ⚠️ Needs more       │
│                │   download      │   storage           │
├────────────────┼─────────────────┼─────────────────────┤
│ Backup         │ Client          │ Server              │
│ responsibility │                 │                     │
├────────────────┼─────────────────┼─────────────────────┤
│ Recommended    │ Single device,  │ Multiple devices,   │
│ for            │ offline work    │ always connected    │
└────────────────┴─────────────────┴─────────────────────┘
```

---

## 🔐 Email Security

### Encryption Options

```
┌─────────────────────────────────────────────────────────┐
│              Email Security Options                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Transport Encryption (TLS):                            │
│  ├── Encrypts connection to server                      │
│  ├── STARTTLS - Upgrade existing connection             │
│  └── Implicit TLS - Always encrypted port               │
│                                                          │
│  End-to-End Encryption:                                 │
│  ├── S/MIME - Certificate-based                         │
│  ├── PGP/GPG - Public key encryption                    │
│  └── Only sender/receiver can read                      │
│                                                          │
│  Authentication:                                        │
│  ├── SPF - Sender Policy Framework                      │
│  ├── DKIM - DomainKeys Identified Mail                  │
│  └── DMARC - Combining SPF + DKIM                       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Port Summary

```
┌───────────────────────────────────────────────────────┐
│              Email Port Summary                        │
├─────────────┬──────────────────────────────────────────┤
│ Protocol    │ Ports                                   │
├─────────────┼──────────────────────────────────────────┤
│ SMTP        │ 25 (server-to-server)                  │
│             │ 587 (submission + STARTTLS) ✓          │
│             │ 465 (SMTPS - implicit TLS)             │
├─────────────┼──────────────────────────────────────────┤
│ POP3        │ 110 (plain) ✗                          │
│             │ 995 (POP3S - SSL/TLS) ✓                │
├─────────────┼──────────────────────────────────────────┤
│ IMAP        │ 143 (plain) ✗                          │
│             │ 993 (IMAPS - SSL/TLS) ✓                │
└─────────────┴──────────────────────────────────────────┘

Always use encrypted ports! ✓
```

---

## 🖥️ Email Client Configuration

### Gmail IMAP/SMTP Settings

```
┌─────────────────────────────────────────────────────────┐
│              Gmail Configuration                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  IMAP (Incoming):                                       │
│  Server: imap.gmail.com                                 │
│  Port: 993                                              │
│  Security: SSL/TLS                                      │
│                                                          │
│  SMTP (Outgoing):                                       │
│  Server: smtp.gmail.com                                 │
│  Port: 587 (STARTTLS) or 465 (SSL)                     │
│  Security: TLS/SSL                                      │
│  Auth: Required                                         │
│                                                          │
│  Note: Requires App Password for 2FA accounts          │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Outlook/Microsoft 365 Settings

```
┌─────────────────────────────────────────────────────────┐
│              Outlook Configuration                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  IMAP:                                                  │
│  Server: outlook.office365.com                          │
│  Port: 993 (SSL/TLS)                                   │
│                                                          │
│  SMTP:                                                  │
│  Server: smtp.office365.com                             │
│  Port: 587 (STARTTLS)                                  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 📝 Email Headers

### Reading Email Headers

```
Email Header Example:

Return-Path: <sender@example.com>
Received: from mail.example.com (192.168.1.1)
    by mx.receiver.com (10.0.0.1);
    Mon, 15 Jan 2024 10:30:00 -0500
From: John Doe <sender@example.com>
To: Jane Smith <receiver@example.com>
Subject: Meeting Tomorrow
Date: Mon, 15 Jan 2024 10:29:55 -0500
Message-ID: <12345@example.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="UTF-8"

(message body...)
```

### Important Headers

```
┌──────────────┬────────────────────────────────────────┐
│ Header       │ Purpose                                │
├──────────────┼────────────────────────────────────────┤
│ From         │ Sender's address                       │
│ To           │ Recipient's address                    │
│ Subject      │ Email subject line                     │
│ Date         │ When sent                              │
│ Received     │ Path through mail servers             │
│ Message-ID   │ Unique identifier                      │
│ Reply-To     │ Where replies should go               │
│ CC           │ Carbon copy recipients                │
│ BCC          │ Blind carbon copy                      │
│ Content-Type │ MIME type (text, html, etc.)          │
└──────────────┴────────────────────────────────────────┘
```

---

## 🔧 Testing with Telnet/OpenSSL

### Test SMTP

```bash
# Test SMTP connection
openssl s_client -starttls smtp -connect smtp.gmail.com:587

# Manual SMTP session
EHLO test
AUTH LOGIN
(base64 username)
(base64 password)
MAIL FROM:<test@example.com>
RCPT TO:<dest@example.com>
DATA
Subject: Test
This is a test.
.
QUIT
```

### Test IMAP

```bash
# Connect to IMAP server
openssl s_client -connect imap.gmail.com:993

# IMAP commands
A001 LOGIN username password
A002 LIST "" "*"
A003 SELECT INBOX
A004 FETCH 1 BODY[HEADER]
A005 LOGOUT
```

---

## ✏️ অনুশীলনী

### ১. Protocol Understanding
```
a) SMTP, POP3, IMAP এর মধ্যে পার্থক্য কী?
b) Email পাঠানোর সময় কোন protocol use হয়?
c) Multiple device থেকে email access করতে 
   কোন protocol best?
```

### ২. Port Identification
```
এই ports গুলো কোন protocol এর?

a) Port 25
b) Port 993
c) Port 587
d) Port 995
e) Port 143
```

### ৩. Configuration Practice
```
নিচের email client settings লিখুন:

a) Gmail - IMAP incoming
b) Gmail - SMTP outgoing
c) কেন port 587 ব্যবহার করা হয়?
```

### ৪. Scenario
```
সমস্যা: User তার phone এ email পড়লে 
laptop এ আর দেখা যায় না।

a) কোন protocol ব্যবহার করছে?
b) সমাধান কী?
```

---

## 🎓 মনে রাখুন

```
Email Protocols:
├── SMTP (25/587/465) - Sending ✉️
├── POP3 (110/995)    - Download 📥
└── IMAP (143/993)    - Sync 🔄

Modern Setup:
- Use IMAP for receiving (multi-device sync)
- Use SMTP port 587 with TLS for sending
- Always use encrypted ports (SSL/TLS)

POP3 vs IMAP:
- POP3 = Download & Delete (single device)
- IMAP = Sync & Keep (multiple devices)

Security:
- Use TLS/SSL always
- Consider end-to-end encryption (PGP/S/MIME)
- Enable SPF/DKIM/DMARC for your domain
```

---

**🔙 [পূর্ববর্তী: FTP এবং SFTP](./??-??????-????????.md)** | **🔜 [পরবর্তী: SNMP](./??-????????.md)**


