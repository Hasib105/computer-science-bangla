# ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрзЗрж▓рж┐ржВ (Database Scaling)

## ЁЯОп ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрзЗрж▓рж┐ржВ ржХрзЗржи ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг?

ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рж╛ржзрж╛рж░ржгржд рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ **рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ ржмржЯрж▓ржирзЗржХ**ред ржХрж╛рж░ржг:
- рж╕ржм ржбрж╛ржЯрж╛ ржПржЦрж╛ржирзЗ ржерж╛ржХрзЗ
- ржбрж┐рж╕рзНржХ I/O рж╕рзНрж▓рзЛ
- ACID ржХржоржкрзНрж▓рж╛ржпрж╝рзЗржирзНрж╕ рж░рж╛ржЦрждрзЗ рж╣ржпрж╝

```
рж╕рж╛ржзрж╛рж░ржг ржмржЯрж▓ржирзЗржХ:
                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
User тЖТ LB тЖТ Server тЖТ тФВ  DATABASE   тФВ тЖР ржмржЯрж▓ржирзЗржХ ржПржЦрж╛ржирзЗ!
                    тФВ   (рж╕рзНрж▓рзЛ)     тФВ
                    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

## ЁЯУК ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрзЗрж▓рж┐ржВ ржХрзМрж╢рж▓

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрзЗрж▓рж┐ржВ ржХрзМрж╢рж▓                           тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ                                                             тФВ
тФВ  рзз. ржнрж╛рж░рзНржЯрж┐ржХрзНржпрж╛рж▓ рж╕рзНржХрзЗрж▓рж┐ржВ (рж╕рж╣ржЬ, ржкрзНрж░ржержо ржзрж╛ржк)                    тФВ
тФВ     тФФтФАтФА ржмржбрж╝ рж╕рж╛рж░рзНржнрж╛рж░, ржмрзЗрж╢рж┐ RAM, ржжрзНрж░рзБржд SSD                    тФВ
тФВ                                                             тФВ
тФВ  рзи. ржХрзНржпрж╛рж╢рж┐ржВ (ржХрзБржпрж╝рзЗрж░рж┐ ржХржорж╛ржирзЛ)                                 тФВ
тФВ     тФФтФАтФА Redis, Memcached                                   тФВ
тФВ                                                             тФВ
тФВ  рзй. рж░рж┐ржб рж░рзЗржкрзНрж▓рж┐ржХрж╛ (рж░рж┐ржб рж╕рзНржХрзЗрж▓)                                тФВ
тФВ     тФФтФАтФА Master-Slave рж░рзЗржкрзНрж▓рж┐ржХрзЗрж╢ржи                            тФВ
тФВ                                                             тФВ
тФВ  рзк. рж╢рж╛рж░рзНржбрж┐ржВ (рж░рж╛ржЗржЯ рж╕рзНржХрзЗрж▓)                                    тФВ
тФВ     тФФтФАтФА ржбрж╛ржЯрж╛ ржнрж╛ржЧ ржХрж░рзЗ рж░рж╛ржЦрж╛                                   тФВ
тФВ                                                             тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

## ЁЯФз рзз. ржнрж╛рж░рзНржЯрж┐ржХрзНржпрж╛рж▓ рж╕рзНржХрзЗрж▓рж┐ржВ

### ржХрж┐ ржХрж░ржмрзЗржи?
```
ржмрж░рзНрждржорж╛ржи рж╕рж╛рж░рзНржнрж╛рж░:              ржЖржкржЧрзНрж░рзЗржб ржХрж░рж╛ рж╕рж╛рж░рзНржнрж╛рж░:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР         тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ 4 CPU            тФВ   тЖТ    тФВ 32 CPU           тФВ
тФВ 16 GB RAM        тФВ         тФВ 256 GB RAM       тФВ
тФВ 500 GB HDD       тФВ         тФВ 2 TB NVMe SSD    тФВ
тФВ                  тФВ         тФВ 10 Gbps Network  тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ         тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рж╕рзБржмрж┐ржзрж╛ ржУ ржЕрж╕рзБржмрж┐ржзрж╛
```
рж╕рзБржмрж┐ржзрж╛:
тЬУ ржХрзЛржирзЛ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи рж▓рж╛ржЧрзЗ ржирж╛
тЬУ ржбрж╛ржЯрж╛ рж╕рж┐ржЩрзНржХ рж╕ржорж╕рзНржпрж╛ ржирзЗржЗ
тЬУ рж╕рж┐ржорзНржкрж▓

ржЕрж╕рзБржмрж┐ржзрж╛:
тЬЧ рж╕рзАржорж╛ ржЖржЫрзЗ (рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ рж╕рж╛рж░рзНржнрж╛рж░)
тЬЧ ржПржХрзНрж╕ржкрзЗржирж╕рж┐ржн
тЬЧ рж╕рж┐ржЩрзНржЧрзЗрж▓ ржкржпрж╝рзЗржирзНржЯ ржЕржл ржлрзЗржЗрж▓рж╛рж░
```

### ржХржЦржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?
```
- ржЫрзЛржЯ ржерзЗржХрзЗ ржорж╛ржЭрж╛рж░рж┐ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи
- ржкрзНрж░ржержо рж╕рзНржХрзЗрж▓рж┐ржВ ржзрж╛ржк рж╣рж┐рж╕рзЗржмрзЗ
- ржпржЦржи ржЬржЯрж┐рж▓ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ ржПржбрж╝рж╛рждрзЗ ржЪрж╛ржи
```

## ЁЯЧГя╕П рзи. ржХрзНржпрж╛рж╢рж┐ржВ

### ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?
```
ржХрзНржпрж╛рж╢ ржЫрж╛ржбрж╝рж╛:
User тЖТ App тЖТ Database (ржкрзНрж░рждрж┐ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯрзЗ)
              100 ms

ржХрзНржпрж╛рж╢ рж╕рж╣:
                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
User тЖТ App тЖТ  тФАтФАтФАтФАтФАтФВ   Redis    тФВ тЖР ржХрзНржпрж╛рж╢ рж╣рж┐ржЯ (95%)
                    тФВ   1 ms     тФВ
                    тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФШ
                           тФВ ржХрзНржпрж╛рж╢ ржорж┐рж╕ (5%)
                           тЖУ
                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                    тФВ  Database  тФВ
                    тФВ   100 ms   тФВ
                    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

ржЧржбрж╝ рж▓рзЗржЯрзЗржирзНрж╕рж┐: 0.95 ├Ч 1 + 0.05 ├Ч 100 = 5.95 ms (17x ржЙржирзНржирждрж┐!)
```

### ржХрзНржпрж╛рж╢рж┐ржВ рж╕рзНржЯрзНрж░рзНржпрж╛ржЯрзЗржЬрж┐
```
рзз. Query Result Caching
   - ржЬржиржкрзНрж░рж┐ржпрж╝ ржХрзБржпрж╝рзЗрж░рж┐рж░ рж░рзЗржЬрж╛рж▓рзНржЯ ржХрзНржпрж╛рж╢ ржХрж░рж╛
   
рзи. Object Caching
   - ржЗржЙржЬрж╛рж░ ржЕржмржЬрзЗржХрзНржЯ, ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржЕржмржЬрзЗржХрзНржЯ ржХрзНржпрж╛рж╢
   
рзй. Session Caching
   - ржЗржЙржЬрж╛рж░ рж╕рзЗрж╢ржи ржХрзНржпрж╛рж╢ ржХрж░рж╛

ржЙржжрж╛рж╣рж░ржг:
# User ржбрж╛ржЯрж╛ ржХрзНржпрж╛рж╢ ржХрж░рж╛
user = cache.get(f"user:{user_id}")
if not user:
    user = db.query("SELECT * FROM users WHERE id = ?", user_id)
    cache.set(f"user:{user_id}", user, ttl=3600)
```

## ЁЯУЦ рзй. рж░рж┐ржб рж░рзЗржкрзНрж▓рж┐ржХрж╛ (Read Replica)

### ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░
```
                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                    тФВ     Primary     тФВ
                    тФВ   (Master)      тФВ
                    тФВ   Write + Read  тФВ
                    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                             тФВ
              тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
              тФВ Replication  тФВ Replication  тФВ
              тЖУ              тЖУ              тЖУ
        тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
        тФВ Replica 1тФВ  тФВ Replica 2тФВ  тФВ Replica 3тФВ
        тФВ  (Read)  тФВ  тФВ  (Read)  тФВ  тФВ  (Read)  тФВ
        тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Write Operations тЖТ Primary Only
Read Operations тЖТ Any Replica
```

### ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?
```
Write Path:
Client тЖТ App тЖТ Primary DB тЖТ Replicate to Replicas

Read Path:
Client тЖТ App тЖТ Any Replica (Load Balanced)

рж╕рж╛ржзрж╛рж░ржг рж░рзЗрж╢рж┐ржУ:
Write:Read = 1:10 ржерзЗржХрзЗ 1:100
рждрж╛ржЗ Read рж╕рзНржХрзЗрж▓ ржХрж░рж▓рзЗ ржмржбрж╝ рж╕рзБржмрж┐ржзрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝
```

### рж░рзЗржкрзНрж▓рж┐ржХрзЗрж╢ржи ржкрзНрж░ржХрж╛рж░ржнрзЗржж
```
рзз. рж╕рж┐ржиржХрзНрж░рзЛржирж╛рж╕ рж░рзЗржкрзНрж▓рж┐ржХрзЗрж╢ржи
   Write тЖТ Primary тЖТ All Replicas тЖТ Ack тЖТ Client
   
   рж╕рзБржмрж┐ржзрж╛: ржбрж╛ржЯрж╛ рж▓рж╕ рж╣ржмрзЗ ржирж╛
   ржЕрж╕рзБржмрж┐ржзрж╛: рж╕рзНрж▓рзЛ, рж▓рзЗржЯрзЗржирзНрж╕рж┐ ржмрзЗрж╢рж┐

рзи. ржЕрзНржпрж╛рж╕рж┐ржиржХрзНрж░рзЛржирж╛рж╕ рж░рзЗржкрзНрж▓рж┐ржХрзЗрж╢ржи  
   Write тЖТ Primary тЖТ Ack тЖТ Client
                тЖУ
           Replicas (ржкрж░рзЗ)
   
   рж╕рзБржмрж┐ржзрж╛: ржлрж╛рж╕рзНржЯ
   ржЕрж╕рзБржмрж┐ржзрж╛: рж░рзЗржкрзНрж▓рж┐ржХрж╛ ржкрзБрж░рж╛рждржи ржбрж╛ржЯрж╛ ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рзЗ
```

### рж░рж┐ржб рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯржЖржк (PostgreSQL)
```sql
-- Primary-рждрзЗ
CREATE PUBLICATION my_publication FOR ALL TABLES;

-- Replica-рждрзЗ
CREATE SUBSCRIPTION my_subscription
    CONNECTION 'host=primary_host dbname=mydb'
    PUBLICATION my_publication;
```

## ЁЯФк рзк. рж╢рж╛рж░рзНржбрж┐ржВ (Sharding)

### рж╢рж╛рж░рзНржбрж┐ржВ ржХрж┐?
ржбрж╛ржЯрж╛ржХрзЗ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржнрж╛ржЧ ржХрж░рзЗ рж░рж╛ржЦрж╛ред

```
рж╢рж╛рж░рзНржбрж┐ржВ ржЫрж╛ржбрж╝рж╛:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ         Database             тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ  тФВ    Users Table         тФВ тФВ
тФВ  тФВ    100 Million Rows    тФВ тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

рж╢рж╛рж░рзНржбрж┐ржВ рж╕рж╣:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ Shard 1  тФВ тФВ Shard 2  тФВ тФВ Shard 3  тФВ тФВ Shard 4  тФВ
тФВ Users    тФВ тФВ Users    тФВ тФВ Users    тФВ тФВ Users    тФВ
тФВ A-G      тФВ тФВ H-N      тФВ тФВ O-T      тФВ тФВ U-Z      тФВ
тФВ 25M rows тФВ тФВ 25M rows тФВ тФВ 25M rows тФВ тФВ 25M rows тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рж╢рж╛рж░рзНржбрж┐ржВ рж╕рзНржЯрзНрж░рзНржпрж╛ржЯрзЗржЬрж┐

#### рзз. Range Based Sharding
```
User ID ржЕржирзБржпрж╛ржпрж╝рзА:
Shard 1: ID 1 - 1,000,000
Shard 2: ID 1,000,001 - 2,000,000
Shard 3: ID 2,000,001 - 3,000,000

рж╕рзБржмрж┐ржзрж╛: рж╕рж┐ржорзНржкрж▓, рж░рзЗржЮрзНржЬ ржХрзБржпрж╝рзЗрж░рж┐ рж╕рж╣ржЬ
ржЕрж╕рзБржмрж┐ржзрж╛: рж╣ржЯрж╕рзНржкржЯ рж╣рждрзЗ ржкрж╛рж░рзЗ (ржирждрзБржи ржЗржЙржЬрж╛рж░ рж╕ржм рж╢рзЗрж╖ рж╢рж╛рж░рзНржбрзЗ)
```

#### рзи. Hash Based Sharding
```
shard_id = hash(user_id) % num_shards

User ID 12345:
hash(12345) = 87654321
87654321 % 4 = 1
тЖТ Shard 1 ржП ржпрж╛ржмрзЗ

рж╕рзБржмрж┐ржзрж╛: рж╕ржорж╛ржи ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи
ржЕрж╕рзБржмрж┐ржзрж╛: рж░рзЗржЮрзНржЬ ржХрзБржпрж╝рзЗрж░рж┐ ржХржарж┐ржи
```

#### рзй. Directory Based Sharding
```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ Lookup Service    тФВ
тФВ тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФРтФВ
тФВ тФВuser_id тЖТ shardтФВтФВ
тФВ тФВ12345 тЖТ shard1 тФВтФВ
тФВ тФВ12346 тЖТ shard2 тФВтФВ
тФВ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШтФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
        тФВ
        тЖУ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ Shard 1 тФВ тФВ Shard 2 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

рж╕рзБржмрж┐ржзрж╛: ржлрзНрж▓рзЗржХрзНрж╕рж┐ржмрж▓
ржЕрж╕рзБржмрж┐ржзрж╛: Lookup рж╕рж╛рж░рзНржнрж┐рж╕ ржмржЯрж▓ржирзЗржХ рж╣рждрзЗ ржкрж╛рж░рзЗ
```

### рж╢рж╛рж░рзНржбрж┐ржВ ржЪрзНржпрж╛рж▓рзЗржЮрзНржЬ
```
рзз. Cross-Shard Queries
   - ржПржХрж╛ржзрж┐ржХ рж╢рж╛рж░рзНржб ржерзЗржХрзЗ ржбрж╛ржЯрж╛ ржЖржирж╛ ржЬржЯрж┐рж▓
   
рзи. Joins
   - рж╢рж╛рж░рзНржб ржЬрзБржбрж╝рзЗ JOIN ржХрж░рж╛ ржпрж╛ржпрж╝ ржирж╛
   
рзй. Resharding
   - рж╢рж╛рж░рзНржб рж╕ржВржЦрзНржпрж╛ ржмрж╛ржбрж╝рж╛рж▓рзЗ ржбрж╛ржЯрж╛ ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи
   
рзк. Consistency
   - ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржПржХрж╛ржзрж┐ржХ рж╢рж╛рж░рзНржб ржЬрзБржбрж╝рзЗ ржЬржЯрж┐рж▓
```

## ЁЯФД рж╕ржорзНржкрзВрж░рзНржг рж╕рзНржХрзЗрж▓рж┐ржВ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░

```
                         тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                         тФВ    Application    тФВ
                         тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                                   тФВ
                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                    тФВ              тФВ              тФВ
                    тЖУ              тЖУ              тЖУ
              тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
              тФВ  Redis   тФВ  тФВ  Redis   тФВ  тФВ  Redis   тФВ
              тФВ (Cache)  тФВ  тФВ (Cache)  тФВ  тФВ (Cache)  тФВ
              тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФШ
                   тФВ             тФВ             тФВ
                   тФВ        Cache Miss         тФВ
                   тЖУ             тЖУ             тЖУ
              тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
              тФВ           Query Router              тФВ
              тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                                тФВ
           тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
           тЖУ                    тЖУ                    тЖУ
    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР      тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР      тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
    тФВ   Shard 1   тФВ      тФВ   Shard 2   тФВ      тФВ   Shard 3   тФВ
    тФВ тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ      тФВ тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ      тФВ тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
    тФВ тФВ Primary тФВ тФВ      тФВ тФВ Primary тФВ тФВ      тФВ тФВ Primary тФВ тФВ
    тФВ тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ тФВ      тФВ тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ тФВ      тФВ тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ тФВ
    тФВ      тФВ      тФВ      тФВ      тФВ      тФВ      тФВ      тФВ      тФВ
    тФВ тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР тФВ      тФВ тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР тФВ      тФВ тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР тФВ
    тФВ тФВReplica 1тФВ тФВ      тФВ тФВReplica 1тФВ тФВ      тФВ тФВReplica 1тФВ тФВ
    тФВ тФВReplica 2тФВ тФВ      тФВ тФВReplica 2тФВ тФВ      тФВ тФВReplica 2тФВ тФВ
    тФВ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ      тФВ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ      тФВ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ      тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ      тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

## ЁЯУЛ ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржХрзЗрж▓рж┐ржВ ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

- [ ] ржХрзБржпрж╝рзЗрж░рж┐ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи (ржЗржиржбрзЗржХрзНрж╕рж┐ржВ)
- [ ] ржХрзНржпрж╛рж╢рж┐ржВ рж▓рзЗржпрж╝рж╛рж░ ржпрзЛржЧ ржХрж░рж╛
- [ ] рж░рж┐ржб рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯржЖржк
- [ ] ржХрж╛ржирзЗржХрж╢ржи ржкрзБрж▓рж┐ржВ
- [ ] рж╕рзНрж▓рзЛ ржХрзБржпрж╝рзЗрж░рж┐ ржоржирж┐ржЯрж░рж┐ржВ
- [ ] рж╢рж╛рж░рзНржбрж┐ржВ рж╕рзНржЯрзНрж░рзНржпрж╛ржЯрзЗржЬрж┐ (ржкрзНрж░ржпрж╝рзЛржЬржирзЗ)
- [ ] ржмрзНржпрж╛ржХржЖржк ржУ рж░рж┐ржХржнрж╛рж░рж┐ ржкрзНрж▓рзНржпрж╛ржи

## ЁЯУЪ ржкрж░ржмрж░рзНрждрзА ржЯржкрж┐ржХ

[рж╢рж╛рж░рзНржбрж┐ржВ тЖТ](./04-sharding.md)
