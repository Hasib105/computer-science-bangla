# à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸ à¦¡à¦¿à¦¸à¦•à¦­à¦¾à¦°à¦¿

## ğŸ¯ à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸ à¦¡à¦¿à¦¸à¦•à¦­à¦¾à¦°à¦¿ à¦•à¦¿?

à¦®à¦¾à¦‡à¦•à§à¦°à§‹à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸à§‡ à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸à§‡à¦° IP/Port dynamicà¥¤ **Service Discovery** à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸à¦—à§à¦²à§‹à¦•à§‡ à¦à¦•à§‡ à¦…à¦ªà¦°à¦•à§‡ à¦–à§à¦à¦œà§‡ à¦ªà§‡à¦¤à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à§‡à¥¤

```
Problem:
Order Service needs to call User Service
But User Service IP can change (scaling, restarts)

Solution:
Service Registry tracks all service locations
```

## ğŸ—ï¸ Service Discovery Patterns

### à§§. Client-Side Discovery
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”€â†’â”‚   Service    â”‚                  â”‚
â”‚  â”‚ (Order)   â”‚    â”‚   Registry   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚              â”‚                  â”‚
â”‚        â”‚          â”‚ user-svc:    â”‚                  â”‚
â”‚        â”‚          â”‚  - 10.0.0.1  â”‚                  â”‚
â”‚        â”‚          â”‚  - 10.0.0.2  â”‚                  â”‚
â”‚        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚        â”‚                                            â”‚
â”‚        â”‚ (1) Query registry                         â”‚
â”‚        â”‚ (2) Get user-svc instances                â”‚
â”‚        â”‚ (3) Choose one (load balance)             â”‚
â”‚        â”‚ (4) Call directly                          â”‚
â”‚        â†“                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚   User    â”‚                                      â”‚
â”‚  â”‚  Service  â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client is responsible for:
- Querying registry
- Load balancing
- Choosing instance
```

### à§¨. Server-Side Discovery
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”€â†’â”‚Load Balancer â”‚                  â”‚
â”‚  â”‚ (Order)   â”‚    â”‚   / Router   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                          â”‚
â”‚                          â”‚ (Knows all instances)    â”‚
â”‚                          â†“                          â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                   â”‚   Service    â”‚                  â”‚
â”‚                   â”‚   Registry   â”‚                  â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â†“                â†“                â†“        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   User    â”‚   â”‚   User    â”‚   â”‚   User    â”‚   â”‚
â”‚   â”‚ Instance1 â”‚   â”‚ Instance2 â”‚   â”‚ Instance3 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Load balancer is responsible for:
- Querying registry
- Load balancing
- Routing requests
```

## ğŸ”§ Service Registry Tools

```
Consul:
- Health checking
- Key-value store
- Multi-datacenter

Eureka (Netflix):
- Java ecosystem
- Spring Cloud integration

etcd:
- Kubernetes uses it
- Distributed key-value

ZooKeeper:
- Apache project
- Coordination service
```

## ğŸ“Š Registration Process

```
Service Startup:
1. Service starts on port 8080
2. Service registers with registry
   {
     "name": "user-service",
     "host": "10.0.0.1",
     "port": 8080,
     "health": "/health"
   }
3. Registry stores the info

Health Checks:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Health check    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Registry   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Service  â”‚
â”‚              â”‚â†â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If health check fails â†’ Remove from registry
```

## ğŸ’¡ Best Practices

```
âœ“ Implement health checks
âœ“ Handle registration failures
âœ“ Use heartbeats
âœ“ Graceful deregistration on shutdown
âœ“ Cache registry data locally
```

---

ğŸ‰ à¦®à¦¾à¦‡à¦•à§à¦°à§‹à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸ à¦¸à§‡à¦•à¦¶à¦¨ à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£!

[API à¦¡à¦¿à¦œà¦¾à¦‡à¦¨ â†’](../08-api-design/README.md)
