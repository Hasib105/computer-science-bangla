# WebSocket à¦“ Real-time Communication

## ğŸ¯ Real-time Options

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Real-time Communication Options                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Polling (Basic):                                           â”‚
â”‚     Client â”€â”€GETâ”€â”€â†’ Server  "Any updates?"                     â”‚
â”‚     Client â†â”€Emptyâ”€ Server  "No"                               â”‚
â”‚     (repeat every N seconds)                                   â”‚
â”‚     âœ— High latency, wasteful                                   â”‚
â”‚                                                                 â”‚
â”‚  2. Long Polling:                                              â”‚
â”‚     Client â”€â”€GETâ”€â”€â†’ Server  "Any updates?"                     â”‚
â”‚     Server holds connection...                                 â”‚
â”‚     Client â†â”€Dataâ”€â”€ Server  (when data available)              â”‚
â”‚     âœ“ Better than polling                                      â”‚
â”‚     âœ— Still HTTP overhead                                      â”‚
â”‚                                                                 â”‚
â”‚  3. Server-Sent Events (SSE):                                  â”‚
â”‚     Client â”€â”€GETâ”€â”€â†’ Server                                     â”‚
â”‚     Server â†â”€streamâ”€ Client (one-way)                          â”‚
â”‚     âœ“ Simple, auto-reconnect                                   â”‚
â”‚     âœ— One-way only                                             â”‚
â”‚                                                                 â”‚
â”‚  4. WebSocket:                                                 â”‚
â”‚     Client â†â”€â”€â”€â”€â†’ Server (bidirectional)                       â”‚
â”‚     Full-duplex, low latency                                   â”‚
â”‚     âœ“ Best for real-time apps                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š WebSocket Handshake

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WebSocket Connection                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. HTTP Upgrade Request:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ GET /chat HTTP/1.1                               â”‚          â”‚
â”‚  â”‚ Host: example.com                                â”‚          â”‚
â”‚  â”‚ Upgrade: websocket                               â”‚          â”‚
â”‚  â”‚ Connection: Upgrade                              â”‚          â”‚
â”‚  â”‚ Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==     â”‚          â”‚
â”‚  â”‚ Sec-WebSocket-Version: 13                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  2. Server Response:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ HTTP/1.1 101 Switching Protocols                 â”‚          â”‚
â”‚  â”‚ Upgrade: websocket                               â”‚          â”‚
â”‚  â”‚ Connection: Upgrade                              â”‚          â”‚
â”‚  â”‚ Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK...â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  3. WebSocket Frames:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                                                  â”‚          â”‚
â”‚  â”‚  Client â†â”€â”€â”€â”€ Text Frame â”€â”€â”€â”€â†’ Server           â”‚          â”‚
â”‚  â”‚  Client â†â”€â”€â”€â”€ Binary Frame â”€â”€â†’ Server           â”‚          â”‚
â”‚  â”‚  Client â†â”€â”€â”€â”€ Ping/Pong â”€â”€â”€â”€â”€â†’ Server           â”‚          â”‚
â”‚  â”‚  Client â†â”€â”€â”€â”€ Close Frame â”€â”€â”€â†’ Server           â”‚          â”‚
â”‚  â”‚                                                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ WebSocket Implementation

```python
# Server (Python with websockets library)
import asyncio
import websockets
import json

connected_clients = set()

async def handler(websocket, path):
    connected_clients.add(websocket)
    try:
        async for message in websocket:
            data = json.loads(message)
            
            # Broadcast to all clients
            for client in connected_clients:
                if client != websocket:
                    await client.send(json.dumps({
                        "user": data["user"],
                        "message": data["message"]
                    }))
    finally:
        connected_clients.remove(websocket)

async def main():
    async with websockets.serve(handler, "localhost", 8765):
        await asyncio.Future()

asyncio.run(main())
```

```javascript
// Client (JavaScript)
const socket = new WebSocket('ws://localhost:8765');

socket.onopen = function(event) {
    console.log('Connected');
    socket.send(JSON.stringify({
        user: 'à¦°à¦¹à¦¿à¦®',
        message: 'à¦¹à§à¦¯à¦¾à¦²à§‹!'
    }));
};

socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    console.log(`${data.user}: ${data.message}`);
};

socket.onclose = function(event) {
    console.log('Disconnected');
};
```

## ğŸ—ï¸ Scaling WebSockets

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Scaling WebSocket Servers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Challenge: User A on Server 1, User B on Server 2             â”‚
â”‚             How to send message from A to B?                   â”‚
â”‚                                                                 â”‚
â”‚  Solution: Pub/Sub Backend                                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                                      â”‚     â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚    â”‚ Server1 â”‚     â”‚ Server2 â”‚     â”‚ Server3 â”‚     â”‚     â”‚
â”‚  â”‚    â”‚ User A  â”‚     â”‚ User B  â”‚     â”‚ User C  â”‚     â”‚     â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â”‚         â”‚               â”‚               â”‚          â”‚     â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚     â”‚
â”‚  â”‚                         â”‚                          â”‚     â”‚
â”‚  â”‚                         â†“                          â”‚     â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚     â”‚
â”‚  â”‚            â”‚     Redis Pub/Sub      â”‚             â”‚     â”‚
â”‚  â”‚            â”‚                        â”‚             â”‚     â”‚
â”‚  â”‚            â”‚  Channel: chat:room:1  â”‚             â”‚     â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚     â”‚
â”‚  â”‚                                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  Flow:                                                         â”‚
â”‚  1. User A sends message                                       â”‚
â”‚  2. Server1 publishes to Redis                                 â”‚
â”‚  3. All servers receive from Redis                             â”‚
â”‚  4. Server2 sends to User B                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ Best Practices

```
âœ“ Heartbeat/ping-pong for connection health
âœ“ Reconnection logic with exponential backoff
âœ“ Message queuing for offline users
âœ“ Room/channel-based broadcasting
âœ“ Connection limits per user
âœ“ Rate limiting messages
```

## ğŸ“š à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦Ÿà¦ªà¦¿à¦•

[Service Mesh â†’](./05-service-mesh.md)
