# Uber System Design

## ðŸŽ¯ Requirements

```
Functional:
- Request ride
- Match with nearby driver
- Real-time location tracking
- Fare calculation
- Payment processing
- Rating system

Non-Functional:
- Millions of concurrent users
- Real-time matching (<10 seconds)
- Location updates every 4 seconds
- Global scale
- High availability
```

## ðŸ“Š High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Uber Architecture                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚  Rider   â”‚                    â”‚  Driver  â”‚                 â”‚
â”‚   â”‚   App    â”‚                    â”‚   App    â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚                               â”‚                        â”‚
â”‚        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                        â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   API      â”‚â†â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                   â”‚  Gateway   â”‚                                â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                         â”‚                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚    â”‚                    â”‚                    â”‚                 â”‚
â”‚    â†“                    â†“                    â†“                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚  Trip    â”‚     â”‚ Matching â”‚     â”‚ Location â”‚               â”‚
â”‚ â”‚ Service  â”‚     â”‚ Service  â”‚     â”‚ Service  â”‚               â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
â”‚      â”‚                â”‚                â”‚                       â”‚
â”‚      â†“                â†“                â†“                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ Trip DB  â”‚   â”‚  Supply   â”‚    â”‚  Redis    â”‚                â”‚
â”‚ â”‚ (MySQL)  â”‚   â”‚   Index   â”‚    â”‚(Location) â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“ Location Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Location Tracking                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Driver sends location every 4 seconds:                        â”‚
â”‚  {driver_id: 123, lat: 23.8103, lng: 90.4125, ts: ...}        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              Geospatial Index                        â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚  Option 1: Geohash                                  â”‚       â”‚
â”‚  â”‚  - Divide world into grid cells                     â”‚       â”‚
â”‚  â”‚  - "u4pruydqqvj" = specific location               â”‚       â”‚
â”‚  â”‚  - Prefix search for nearby                         â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚  Option 2: Quadtree                                 â”‚       â”‚
â”‚  â”‚  - Hierarchical spatial partitioning               â”‚       â”‚
â”‚  â”‚  - Dynamic subdivision based on density             â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚  Option 3: S2 Cells (Google)                        â”‚       â”‚
â”‚  â”‚  - Hierarchical spherical cells                     â”‚       â”‚
â”‚  â”‚  - Used by Uber                                     â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  Storage: Redis with geo commands                              â”‚
â”‚  GEOADD drivers 90.4125 23.8103 driver:123                    â”‚
â”‚  GEORADIUS drivers 90.4125 23.8103 5 km                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Matching Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Ride Matching Flow                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Rider requests ride                                        â”‚
â”‚     {pickup: (lat, lng), dropoff: (lat, lng)}                 â”‚
â”‚                                                                 â”‚
â”‚  2. Find nearby drivers (within radius)                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚     â”‚     Rider Location      â”‚                                â”‚
â”‚     â”‚           âŠ•             â”‚                                â”‚
â”‚     â”‚      â•±   â•²              â”‚                                â”‚
â”‚     â”‚   D1     D2  D3        â”‚                                â”‚
â”‚     â”‚    â†–     â†‘   â†—         â”‚                                â”‚
â”‚     â”‚      â•²   â”‚  â•±           â”‚                                â”‚
â”‚     â”‚       5 km radius       â”‚                                â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â”‚  3. Score each driver                                          â”‚
â”‚     Score = f(distance, ETA, rating, availability)            â”‚
â”‚                                                                 â”‚
â”‚  4. Send request to best driver                                â”‚
â”‚     - Timeout: 15 seconds                                      â”‚
â”‚     - If declined, try next                                    â”‚
â”‚                                                                 â”‚
â”‚  5. Driver accepts â†’ Create trip                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ’° Surge Pricing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Dynamic Pricing                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Demand/Supply Ratio:                                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                                              â”‚              â”‚
â”‚  â”‚  Surge = Demand / Supply                     â”‚              â”‚
â”‚  â”‚                                              â”‚              â”‚
â”‚  â”‚  Area: Downtown                              â”‚              â”‚
â”‚  â”‚  Current Riders: 500                         â”‚              â”‚
â”‚  â”‚  Available Drivers: 100                      â”‚              â”‚
â”‚  â”‚  Ratio: 5:1                                  â”‚              â”‚
â”‚  â”‚  Surge: 2.5x                                 â”‚              â”‚
â”‚  â”‚                                              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚  Geofence-based surge zones                                    â”‚
â”‚  Real-time calculation                                         â”‚
â”‚  ML predictions for events                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ—„ï¸ Database Schema

```sql
-- Trips
CREATE TABLE trips (
    trip_id UUID PRIMARY KEY,
    rider_id UUID,
    driver_id UUID,
    pickup_location POINT,
    dropoff_location POINT,
    status ENUM('requested', 'matched', 'started', 'completed', 'cancelled'),
    fare_amount DECIMAL(10,2),
    surge_multiplier DECIMAL(3,2),
    created_at TIMESTAMP,
    started_at TIMESTAMP,
    completed_at TIMESTAMP
);

-- Drivers
CREATE TABLE drivers (
    driver_id UUID PRIMARY KEY,
    name VARCHAR(100),
    phone VARCHAR(20),
    vehicle_type VARCHAR(20),
    rating DECIMAL(2,1),
    is_active BOOLEAN,
    current_location POINT,
    last_location_update TIMESTAMP
);

-- Location History (for analytics, time-series DB)
CREATE TABLE location_history (
    driver_id UUID,
    location POINT,
    timestamp TIMESTAMP,
    PRIMARY KEY (driver_id, timestamp)
);
```

## ðŸ’¡ Key Design Patterns

```
âœ“ Sharding by city/region
  - Geo-partitioning
  - Reduced latency

âœ“ Real-time messaging
  - WebSocket for location updates
  - Push notifications

âœ“ Ringpop (Uber's consistent hashing)
  - Distribute load across servers
  - Handle server failures
```

## ðŸ“š à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦Ÿà¦ªà¦¿à¦•

[E-commerce Design â†’](./04-ecommerce.md)
