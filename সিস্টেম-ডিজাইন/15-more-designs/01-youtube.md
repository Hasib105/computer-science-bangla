# YouTube System Design

## ğŸ¯ Requirements

```
Functional:
- Upload videos
- Watch videos
- Search videos
- Like/Comment
- Subscribe to channels

Non-Functional:
- 2B+ users
- 500 hours video uploaded per minute
- High availability
- Low latency playback
- Global reach
```

## ğŸ“Š High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YouTube Architecture                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚ Mobile  â”‚â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚   App   â”‚    â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                  â”œâ”€â”€â”€â”€â”€â†’â”‚    CDN       â”‚ â†â”€â”€â”€â”€ Video Delivery  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚ (Edge Cache) â”‚                      â”‚
â”‚   â”‚   Web   â”‚â”€â”€â”€â”€â”¤      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚   â”‚ Browser â”‚    â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                  â””â”€â”€â”€â”€â”€â†’â”‚ Load Balancerâ”‚                       â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                â”‚                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚              â”‚                 â”‚                 â”‚            â”‚
â”‚              â†“                 â†“                 â†“            â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚        â”‚ API      â”‚     â”‚  Video   â”‚     â”‚  Search  â”‚        â”‚
â”‚        â”‚ Gateway  â”‚     â”‚ Service  â”‚     â”‚ Service  â”‚        â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚             â”‚                â”‚                 â”‚              â”‚
â”‚             â†“                â†“                 â†“              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚        â”‚  MySQL   â”‚   â”‚Object Storageâ”‚  â”‚Elasticsearchâ”‚       â”‚
â”‚        â”‚(Metadata)â”‚   â”‚   (Videos)   â”‚  â”‚  (Search)  â”‚       â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¤ Video Upload Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Video Upload Pipeline                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  User         Upload          Original        Transcoding      â”‚
â”‚  â”Œâ”€â”€â”€â”       Service          Storage         Queue            â”‚
â”‚  â”‚   â”‚â”€â”€â”€â”€â”€â”€â†’â”Œâ”€â”€â”€â”€â”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”Œâ”€â”€â”€â”€â”â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”Œâ”€â”€â”€â”€â”          â”‚
â”‚  â””â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”˜           â”‚ S3 â”‚          â”‚ MQ â”‚          â”‚
â”‚                               â””â”€â”€â”€â”€â”˜          â””â”€â”€â”¬â”€â”˜          â”‚
â”‚                                                  â”‚             â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                               â”‚                                â”‚
â”‚                               â†“                                â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                        â”‚ Transcoding â”‚                        â”‚
â”‚                        â”‚   Workers   â”‚                        â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                               â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â†“                â†“                â†“              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         â”‚ 240p   â”‚      â”‚ 480p   â”‚      â”‚ 1080p  â”‚           â”‚
â”‚         â”‚        â”‚      â”‚        â”‚      â”‚  4K    â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                               â”‚                                â”‚
â”‚                               â†“                                â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                        â”‚ CDN Upload  â”‚                        â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                 â”‚
â”‚  Adaptive Bitrate Streaming (HLS/DASH)                        â”‚
â”‚  - Multiple resolutions                                        â”‚
â”‚  - Client picks based on bandwidth                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“º Video Streaming

```
Adaptive Bitrate Streaming:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Video Player Logic                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  1. Request manifest file (.m3u8)           â”‚
â”‚  2. Manifest lists all quality levels       â”‚
â”‚  3. Player checks bandwidth                  â”‚
â”‚  4. Requests appropriate quality chunks      â”‚
â”‚  5. Dynamically switch quality              â”‚
â”‚                                              â”‚
â”‚  manifest.m3u8:                             â”‚
â”‚  â”œâ”€â”€ 240p/segment_001.ts                    â”‚
â”‚  â”œâ”€â”€ 480p/segment_001.ts                    â”‚
â”‚  â”œâ”€â”€ 720p/segment_001.ts                    â”‚
â”‚  â””â”€â”€ 1080p/segment_001.ts                   â”‚
â”‚                                              â”‚
â”‚  Good bandwidth â†’ 1080p                      â”‚
â”‚  Poor bandwidth â†’ 480p (auto switch)         â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Database Schema

```sql
-- Videos table
CREATE TABLE videos (
    video_id UUID PRIMARY KEY,
    user_id UUID,
    title VARCHAR(500),
    description TEXT,
    upload_time TIMESTAMP,
    duration_seconds INT,
    status ENUM('processing', 'ready', 'failed'),
    view_count BIGINT DEFAULT 0,
    like_count BIGINT DEFAULT 0
);

-- Video URLs for different qualities
CREATE TABLE video_urls (
    video_id UUID,
    quality VARCHAR(10),  -- '240p', '480p', '720p', '1080p'
    url VARCHAR(500),
    PRIMARY KEY (video_id, quality)
);

-- Comments
CREATE TABLE comments (
    comment_id UUID PRIMARY KEY,
    video_id UUID,
    user_id UUID,
    content TEXT,
    created_at TIMESTAMP,
    like_count INT DEFAULT 0
);
```

## ğŸ’¡ Key Design Decisions

```
âœ“ CDN for video delivery
  - Edge caching near users
  - Reduces origin load

âœ“ Async video processing
  - Queue-based transcoding
  - Multiple worker instances

âœ“ Adaptive bitrate
  - Better user experience
  - Works on varying networks

âœ“ Separate read/write paths
  - Heavy reads from replicas
  - Writes to primary
```

## ğŸ“š à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦Ÿà¦ªà¦¿à¦•

[Netflix Design â†’](./02-netflix.md)
