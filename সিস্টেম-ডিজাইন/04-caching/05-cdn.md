# CDN (Content Delivery Network)

## ЁЯОп CDN ржХрж┐?

**CDN** рж╣рж▓рзЛ ржмрж┐рж╢рзНржмржЬрзБржбрж╝рзЗ ржЫржбрж╝рж┐ржпрж╝рзЗ ржерж╛ржХрж╛ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржпрж╛ ржЗржЙржЬрж╛рж░рзЗрж░ ржирж┐ржХржЯрждржо рж▓рзЛржХрзЗрж╢ржи ржерзЗржХрзЗ ржХржирзНржЯрзЗржирзНржЯ рж╕рж╛рж░рзНржн ржХрж░рзЗред

```
CDN ржЫрж╛ржбрж╝рж╛:
User (ржврж╛ржХрж╛) тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЖТ Origin (USA)
             рзйрзжрзж ms round trip

CDN рж╕рж╣:
User (ржврж╛ржХрж╛) тФАтФАтФАтФАтЖТ CDN Edge (Singapore) тЖР Origin (USA)
             рзлрзж ms                      (cached)

рзмx ржжрзНрж░рзБржд!
```

## ЁЯУК CDN ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                         CDN Architecture                        тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ                                                                 тФВ
тФВ                      тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР                          тФВ
тФВ                      тФВOrigin Server тФВ                          тФВ
тФВ                      тФВ   (USA)      тФВ                          тФВ
тФВ                      тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФШ                          тФВ
тФВ                             тФВ                                   тФВ
тФВ              тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР                   тФВ
тФВ              тФВ              тФВ              тФВ                    тФВ
тФВ         тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФР             тФВ
тФВ         тФВCDN Edge тФВ    тФВCDN Edge тФВ    тФВCDN Edge тФВ             тФВ
тФВ         тФВ (Asia)  тФВ    тФВ(Europe) тФВ    тФВ(America)тФВ             тФВ
тФВ         тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФмтФАтФАтФАтФАтФШ             тФВ
тФВ              тФВ              тФВ              тФВ                    тФВ
тФВ          тФМтФАтФАтФАтФ┤тФАтФАтФАтФР      тФМтФАтФАтФАтФ┤тФАтФАтФАтФР      тФМтФАтФАтФАтФ┤тФАтФАтФАтФР              тФВ
тФВ          тФВUsers  тФВ      тФВUsers  тФВ      тФВUsers  тФВ              тФВ
тФВ          тФВ(Asia) тФВ      тФВ(Europe)тФВ     тФВ(America)тФВ             тФВ
тФВ          тФФтФАтФАтФАтФАтФАтФАтФАтФШ      тФФтФАтФАтФАтФАтФАтФАтФАтФШ      тФФтФАтФАтФАтФАтФАтФАтФАтФШ              тФВ
тФВ                                                                 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржлрзНрж▓рзЛ
```
рзз. User example.com/image.jpg рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржХрж░рзЗ
рзи. DNS ржирж┐ржХржЯрждржо CDN Edge рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкржпрж╝рзЗржирзНржЯ ржХрж░рзЗ
рзй. Edge рж╕рж╛рж░рзНржнрж╛рж░ ржЪрзЗржХ ржХрж░рзЗ ржХрзНржпрж╛рж╢рзЗ ржЖржЫрзЗ ржХрж┐ржирж╛

Cache Hit:
тФЬтФАтФА Edge ржерзЗржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ рж╕рж╛рж░рзНржн
тФФтФАтФА Origin-ржП ржпрзЗрждрзЗ рж╣ржпрж╝ ржирж╛

Cache Miss:
тФЬтФАтФА Edge тЖТ Origin ржерзЗржХрзЗ ржлрзЗржЪ ржХрж░рзЗ
тФЬтФАтФА Edge-ржП ржХрзНржпрж╛рж╢ ржХрж░рзЗ
тФФтФАтФА User-ржХрзЗ рж╕рж╛рж░рзНржн ржХрж░рзЗ
```

## ЁЯЫбя╕П CDN ржПрж░ рж╕рзБржмрж┐ржзрж╛

### рзз. ржХржо рж▓рзЗржЯрзЗржирзНрж╕рж┐
```
ржнрзМржЧрзЛрж▓рж┐ржХ ржжрзВрж░рждрзНржм ржХржорж╛ржпрж╝:

USA ржерзЗржХрзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢:
тФЬтФАтФА Without CDN: рзйрзжрзж+ ms
тФФтФАтФА With CDN (Singapore): рзлрзж ms
```

### рзи. Origin Server рж▓рзЛржб ржХржорж╛ржпрж╝
```
Origin ржП рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ:
тФЬтФАтФА Without CDN: рззрзжрзж%
тФФтФАтФА With CDN: рзл-рззрзж% (рж╢рзБржзрзБ cache miss)
```

### рзй. DDoS Protection
```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   DDoS Attack    тФВ
тФВ   тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тЖУ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   CDN Absorbs    тФВ
тФВ   Attack Traffic тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тЖУ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   Origin Safe    тФВ
тФВ   тЦУтЦСтЦСтЦСтЦСтЦСтЦСтЦСтЦСтЦСтЦСтЦС   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рзк. High Availability
```
Origin ржбрж╛ржЙржи рж╣рж▓рзЗржУ:
тФЬтФАтФА Cached content рж╕рж╛рж░рзНржн ржХрж░рж╛ ржпрж╛ржпрж╝
тФЬтФАтФА Multiple Edge servers ржерзЗржХрзЗ
тФФтФАтФА Graceful degradation
```

## ЁЯУж CDN ржП ржХрж┐ ржХрзНржпрж╛рж╢ ржХрж░ржмрзЗржи?

### Static Content (рж╕рж╛ржзрж╛рж░ржгржд ржХрзНржпрж╛рж╢ ржХрж░рж╛ рж╣ржпрж╝)
```
тЬУ Images (jpg, png, gif, svg)
тЬУ CSS files
тЬУ JavaScript files
тЬУ Fonts
тЬУ Videos
тЬУ PDFs
тЬУ Static HTML
```

### Dynamic Content (рж╕рж╛ржмржзрж╛ржирзЗ ржХрзНржпрж╛рж╢)
```
тЪа API responses (рж╢рж░рзНрждрж╕рж╛ржкрзЗржХрзНрж╖рзЗ)
тЪа Personalized content (рж╕рж╛ржзрж╛рж░ржгржд ржирж╛)
тЪа User-specific data (рж╕рж╛ржзрж╛рж░ржгржд ржирж╛)
```

## ЁЯФз CDN ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

### Cache Headers
```http
# рзз ржмржЫрж░ ржХрзНржпрж╛рж╢ (immutable assets)
Cache-Control: public, max-age=31536000, immutable

# рзз ржШржирзНржЯрж╛ ржХрзНржпрж╛рж╢, revalidate
Cache-Control: public, max-age=3600, must-revalidate

# ржХрзНржпрж╛рж╢ ржХрж░ржмрзЗ ржирж╛
Cache-Control: private, no-store

# ETag ржжрж┐ржпрж╝рзЗ validation
ETag: "abc123"
```

### Nginx Configuration
```nginx
location /static/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

location /api/ {
    expires off;
    add_header Cache-Control "no-store";
}
```

## ЁЯФД Cache Invalidation

### рзз. Purge
```bash
# Cloudflare API
curl -X POST "https://api.cloudflare.com/client/v4/zones/{zone_id}/purge_cache" \
     -H "Authorization: Bearer {token}" \
     -d '{"files":["https://example.com/image.jpg"]}'
```

### рзи. Cache Busting (Versioning)
```html
<!-- URL-ржП version ржпрзЛржЧ ржХрж░рж╛ -->
<link href="/css/style.css?v=1.2.3" rel="stylesheet">
<script src="/js/app.js?hash=abc123"></script>

<!-- ржмрж╛ ржлрж╛ржЗрж▓ ржирж╛ржорзЗ hash -->
<link href="/css/style.abc123.css" rel="stylesheet">
```

### рзй. TTL Based
```
ржХржо TTL тЖТ ржмрзЗрж╢рж┐ ржлрзНрж░рзЗрж╢, ржХржо ржХрзНржпрж╛рж╢ рж╣рж┐ржЯ
ржмрзЗрж╢рж┐ TTL тЖТ ржХржо ржлрзНрж░рзЗрж╢, ржмрзЗрж╢рж┐ ржХрзНржпрж╛рж╢ рж╣рж┐ржЯ

рж╕рж╛ржЬрзЗрж╢ржи:
тФЬтФАтФА Static assets: рзз ржмржЫрж░ (versioned)
тФЬтФАтФА API responses: рзз ржорж┐ржирж┐ржЯ - рзз ржШржирзНржЯрж╛
тФФтФАтФА HTML pages: рзл ржорж┐ржирж┐ржЯ - рзз ржШржирзНржЯрж╛
```

## тШБя╕П ржЬржиржкрзНрж░рж┐ржпрж╝ CDN Providers

### рзз. Cloudflare
```
рж╕рзБржмрж┐ржзрж╛:
тЬУ ржлрзНрж░рж┐ ржкрзНрж▓рзНржпрж╛ржи ржЖржЫрзЗ
тЬУ DDoS protection
тЬУ WAF (Web Application Firewall)
тЬУ рж╕рж╣ржЬ рж╕рзЗржЯржЖржк

ржмрзНржпржмрж╣рж╛рж░: ржЫрзЛржЯ-ржмржбрж╝ рж╕ржм ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯ
```

### рзи. AWS CloudFront
```
рж╕рзБржмрж┐ржзрж╛:
тЬУ AWS ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи (S3, EC2)
тЬУ Lambda@Edge
тЬУ ржмржбрж╝ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ

ржмрзНржпржмрж╣рж╛рж░: AWS-based ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи
```

### рзй. Akamai
```
рж╕рзБржмрж┐ржзрж╛:
тЬУ рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ
тЬУ Enterprise features
тЬУ Media streaming

ржмрзНржпржмрж╣рж╛рж░: Enterprise, Media companies
```

### рзк. Fastly
```
рж╕рзБржмрж┐ржзрж╛:
тЬУ Real-time purging
тЬУ Edge computing
тЬУ Developer-friendly

ржмрзНржпржмрж╣рж╛рж░: Tech companies
```

## ЁЯУК CDN рждрзБрж▓ржирж╛

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   Feature   тФВCloudflareтФВCloudFrontтФВ  Akamai  тФВ  Fastly  тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ Free Tier   тФВ    тЬУ     тФВ  Limited тФВ    тЬЧ     тФВ    тЬЧ     тФВ
тФВ Edge Points тФВ   275+   тФВ   225+   тФВ   300+   тФВ   80+    тФВ
тФВ DDoS        тФВ    тЬУ     тФВ    тЬУ     тФВ    тЬУ     тФВ    тЬУ     тФВ
тФВ WAF         тФВ    тЬУ     тФВ    тЬУ     тФВ    тЬУ     тФВ    тЬУ     тФВ
тФВ Edge ComputeтФВ   WorkersтФВLambda@E  тФВEdgeWorkerтФВ  Compute тФВ
тФВ Real-time   тФВ   тЬЧ      тФВ    тЬЧ     тФВ    тЬЧ     тФВ    тЬУ     тФВ
тФВ Purge       тФВ          тФВ          тФВ          тФВ          тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

## тЬЕ CDN ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

- [ ] рж╕ржарж┐ржХ CDN ржкрзНрж░рзЛржнрж╛ржЗржбрж╛рж░ ржирж┐рж░рзНржмрж╛ржЪржи
- [ ] Cache headers ржХржиржлрж┐ржЧрж╛рж░
- [ ] Static assets versioning
- [ ] Purge strategy
- [ ] Origin Shield (optional)
- [ ] Monitoring рж╕рзЗржЯржЖржк
- [ ] SSL/TLS ржХржиржлрж┐ржЧрж╛рж░

## ЁЯУЪ ржкрж░ржмрж░рзНрждрзА рж╕рзЗржХрж╢ржи

[ржбрж╛ржЯрж╛ржмрзЗрж╕ тЖТ](../05-database/README.md)
